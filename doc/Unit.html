<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=UTF-8" />
<title>Class: Unit</title>
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (U)</a> &raquo; 
    
    
    <span class="title">Unit</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Unit 
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><a href="Numeric.html" title="Numeric (class)">Numeric</a></span>
      
        <ul class="fullTree">
          <li><a href="Object.html" title="Object (class)">Object</a></li>
          
            <li class="next"><a href="Numeric.html" title="Numeric (class)">Numeric</a></li>
          
            <li class="next">Unit</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/ruby_units/ruby-units.rb<span class="defines">,<br />
  lib/ruby_units/units.rb</span>
</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>= Ruby Units</p>

<p>Copyright 2006 by Kevin C. Olbrich, Ph.D.</p>

<p>See http://rubyforge.org/ruby-units/</p>

<p>http://www.sciwerks.org</p>

<p>mailto://kevin.olbrich+ruby-units@gmail.com</p>

<p>See README for detailed usage instructions and examples</p>

<p>==Unit Definition Format</p>

<p> '<name>'  => [%w<tt>synonyms</tt>, conversion_to_base, :classification, %w<tt><units> <in> <numerator></tt> , %w<tt><units> <in> <denominator></tt> ],</p>

<p>Prefixes (e.g., a :prefix classification) get special handling
Note: The accuracy of unit conversions depends on the precision of the conversion factor.
If you have more accurate estimates for particular conversion factors, please send them
to me and I will incorporate them into the next release.  It is also incumbent on the end-user
to ensure that the accuracy of any conversions is sufficient for their intended application.</p>

<p>While there are a large number of unit specified in the base package,
there are also a large number of units that are not included.
This package covers nearly all SI, Imperial, and units commonly used
in the United States. If your favorite units are not listed here, send me an email</p>

<p>To add / override a unit definition, add a code block like this..</p>

<p> class Unit &lt; Numeric
  @@USER_DEFINITIONS = {
   <name>'  => [%w<tt>synonyms</tt>, conversion_to_base, :classification, %w<tt><units> <in> <numerator></tt> , %w<tt><units> <in> <denominator></tt> ]
   }
 end
 Unit.setup</p>

  </div>
</div>
<div class="tags">
  
</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="UNIT_DEFINITIONS-constant" class="">UNIT_DEFINITIONS =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='lbrace token'>{</span> 
  <span class='comment val'># prefixes</span>
  <span class='string val'>'&lt;googol&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{googol}</span><span class='comma token'>,</span> <span class='float val'>1e100</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;kibi&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{Ki Kibi kibi}</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='pow op'>**</span><span class='integer val'>10</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;mebi&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{Mi Mebi mebi}</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='pow op'>**</span><span class='integer val'>20</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;gibi&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{Gi Gibi gibi}</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='pow op'>**</span><span class='integer val'>30</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;tebi&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{Ti Tebi tebi}</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='pow op'>**</span><span class='integer val'>40</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;pebi&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{Pi Pebi pebi}</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='pow op'>**</span><span class='integer val'>50</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;exi&gt;'</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{Ei Exi exi}</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='pow op'>**</span><span class='integer val'>60</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;zebi&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{Zi Zebi zebi}</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='pow op'>**</span><span class='integer val'>70</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;yebi&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{Yi Yebi yebi}</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='pow op'>**</span><span class='integer val'>80</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;yotta&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{Y Yotta yotta}</span><span class='comma token'>,</span> <span class='float val'>1e24</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;zetta&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{Z Zetta zetta}</span><span class='comma token'>,</span> <span class='float val'>1e21</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;exa&gt;'</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{E Exa exa}</span><span class='comma token'>,</span> <span class='float val'>1e18</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;peta&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{P Peta peta}</span><span class='comma token'>,</span> <span class='float val'>1e15</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;tera&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{T Tera tera}</span><span class='comma token'>,</span> <span class='float val'>1e12</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;giga&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{G Giga giga}</span><span class='comma token'>,</span> <span class='float val'>1e9</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;mega&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{M Mega mega}</span><span class='comma token'>,</span> <span class='float val'>1e6</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;kilo&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{k kilo}</span><span class='comma token'>,</span> <span class='float val'>1e3</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;hecto&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{h Hecto hecto}</span><span class='comma token'>,</span> <span class='float val'>1e2</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;deca&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{da Deca deca deka}</span><span class='comma token'>,</span> <span class='float val'>1e1</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;deci&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{d Deci deci}</span><span class='comma token'>,</span> <span class='float val'>1e-1</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;centi&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{c Centi centi}</span><span class='comma token'>,</span> <span class='float val'>1e-2</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;milli&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{m Milli milli}</span><span class='comma token'>,</span> <span class='float val'>1e-3</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;micro&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{u Micro micro}</span><span class='comma token'>,</span> <span class='float val'>1e-6</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;nano&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{n Nano nano}</span><span class='comma token'>,</span> <span class='float val'>1e-9</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;pico&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{p Pico pico}</span><span class='comma token'>,</span> <span class='float val'>1e-12</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;femto&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{f Femto femto}</span><span class='comma token'>,</span> <span class='float val'>1e-15</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;atto&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{a Atto atto}</span><span class='comma token'>,</span> <span class='float val'>1e-18</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;zepto&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{z Zepto zepto}</span><span class='comma token'>,</span> <span class='float val'>1e-21</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;yocto&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{y Yocto yocto}</span><span class='comma token'>,</span> <span class='float val'>1e-24</span><span class='comma token'>,</span> <span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;1&gt;'</span>     <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{1}</span><span class='comma token'>,</span><span class='integer val'>1</span><span class='comma token'>,</span><span class='symbol val'>:prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'># length units</span>
  <span class='string val'>'&lt;meter&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{m meter meters metre metres}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span> <span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;inch&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{in inch inches &quot;}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.0254</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;foot&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{ft foot feet '}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.3048</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;yard&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{yd yard yards}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.9144</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;mile&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{mi mile miles}</span><span class='comma token'>,</span> <span class='float val'>1609.344</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;naut-mile&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{nmi}</span><span class='comma token'>,</span> <span class='integer val'>1852</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;league&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{league leagues}</span><span class='comma token'>,</span> <span class='integer val'>4828</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;furlong&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{furlong furlongs}</span><span class='comma token'>,</span> <span class='float val'>201.2</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;rod&gt;'</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{rd rod rods}</span><span class='comma token'>,</span> <span class='float val'>5.029</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;mil&gt;'</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{mil mils}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.0000254</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;angstrom&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='dstring node'>%w{ang angstrom angstroms}</span><span class='comma token'>,</span> <span class='float val'>1e-10</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;fathom&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{fathom fathoms}</span><span class='comma token'>,</span> <span class='float val'>1.829</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>  
  <span class='string val'>'&lt;pica&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{pica picas}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.004217</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;point&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{pt point points}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.0003514</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;redshift&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{z red-shift}</span><span class='comma token'>,</span> <span class='float val'>1.302773e26</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;AU&gt;'</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{AU astronomical-unit}</span><span class='comma token'>,</span> <span class='integer val'>149597900000</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;light-second&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='dstring node'>%w{ls light-second}</span><span class='comma token'>,</span> <span class='integer val'>299792500</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;light-minute&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='dstring node'>%w{lmin light-minute}</span><span class='comma token'>,</span> <span class='integer val'>17987550000</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;light-year&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{ly light-year}</span><span class='comma token'>,</span> <span class='integer val'>9460528000000000</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;parsec&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{pc parsec parsecs}</span><span class='comma token'>,</span> <span class='integer val'>30856780000000000</span><span class='comma token'>,</span> <span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#mass</span>
  <span class='string val'>'&lt;kilogram&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{kg kilogram kilograms}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:mass</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;AMU&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{u AMU amu}</span><span class='comma token'>,</span> <span class='float val'>6.0221415e26</span><span class='comma token'>,</span> <span class='symbol val'>:mass</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;dalton&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{Da Dalton Daltons dalton daltons}</span><span class='comma token'>,</span> <span class='float val'>6.0221415e26</span><span class='comma token'>,</span> <span class='symbol val'>:mass</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;slug&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{slug slugs}</span><span class='comma token'>,</span> <span class='float val'>14.5939029</span><span class='comma token'>,</span> <span class='symbol val'>:mass</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;short-ton&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{tn ton}</span><span class='comma token'>,</span> <span class='float val'>907.18474</span><span class='comma token'>,</span> <span class='symbol val'>:mass</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;metric-ton&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='dstring node'>%w{tonne}</span><span class='comma token'>,</span> <span class='integer val'>1000</span><span class='comma token'>,</span> <span class='symbol val'>:mass</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;carat&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{ct carat carats}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.0002</span><span class='comma token'>,</span> <span class='symbol val'>:mass</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;pound&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{lbs lb pound pounds #}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.45359237</span><span class='comma token'>,</span> <span class='symbol val'>:mass</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;ounce&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{oz ounce ounces}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.0283495231</span><span class='comma token'>,</span> <span class='symbol val'>:mass</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;gram&gt;'</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{g gram grams gramme grammes}</span><span class='comma token'>,</span><span class='float val'>1e-3</span><span class='comma token'>,</span><span class='symbol val'>:mass</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#area</span>
  <span class='string val'>'&lt;hectare&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='dstring node'>%w{hectare}</span><span class='comma token'>,</span> <span class='integer val'>10000</span><span class='comma token'>,</span> <span class='symbol val'>:area</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;acre&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='dstring node'>%w(acre acres)</span><span class='comma token'>,</span> <span class='float val'>4046.85642</span><span class='comma token'>,</span> <span class='symbol val'>:area</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;sqft&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='dstring node'>%w(sqft)</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='symbol val'>:area</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;feet&gt; &lt;feet&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#volume</span>
  <span class='string val'>'&lt;liter&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{l L liter liters litre litres}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.001</span><span class='comma token'>,</span> <span class='symbol val'>:volume</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;gallon&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{gal gallon gallons}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.0037854118</span><span class='comma token'>,</span> <span class='symbol val'>:volume</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;quart&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{qt quart quarts}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.00094635295</span><span class='comma token'>,</span> <span class='symbol val'>:volume</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;pint&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{pt pint pints}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.000473176475</span><span class='comma token'>,</span> <span class='symbol val'>:volume</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;cup&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{cu cup cups}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.000236588238</span><span class='comma token'>,</span> <span class='symbol val'>:volume</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;fluid-ounce&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{floz fluid-ounce}</span><span class='comma token'>,</span> <span class='float val'>2.95735297e-5</span><span class='comma token'>,</span> <span class='symbol val'>:volume</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;tablespoon&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{tbs tablespoon tablespoons}</span><span class='comma token'>,</span> <span class='float val'>1.47867648e-5</span><span class='comma token'>,</span> <span class='symbol val'>:volume</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;teaspoon&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{tsp teaspoon teaspoons}</span><span class='comma token'>,</span> <span class='float val'>4.92892161e-6</span><span class='comma token'>,</span> <span class='symbol val'>:volume</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#speed</span>
  <span class='string val'>'&lt;kph&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{kph}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.277777778</span><span class='comma token'>,</span> <span class='symbol val'>:speed</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;mph&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{mph}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.44704</span><span class='comma token'>,</span> <span class='symbol val'>:speed</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;knot&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{kt kn kts knot knots}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.514444444</span><span class='comma token'>,</span> <span class='symbol val'>:speed</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;fps&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{fps}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.3048</span><span class='comma token'>,</span> <span class='symbol val'>:speed</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  
  <span class='comment val'>#acceleration</span>
  <span class='string val'>'&lt;gee&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{gee}</span><span class='comma token'>,</span> <span class='float val'>9.80655</span><span class='comma token'>,</span> <span class='symbol val'>:acceleration</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#temperature_difference</span>
  <span class='string val'>'&lt;kelvin&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{degK kelvin}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:temperature</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kelvin&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;celsius&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{degC celsius celsius centigrade}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:temperature</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kelvin&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;fahrenheit&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{degF fahrenheit}</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='div op'>/</span><span class='float val'>1.8</span><span class='comma token'>,</span> <span class='symbol val'>:temperature</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kelvin&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;rankine&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{degR rankine}</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='div op'>/</span><span class='float val'>1.8</span><span class='comma token'>,</span> <span class='symbol val'>:temperature</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kelvin&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;temp-K&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{tempK}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:temperature</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;temp-K&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;temp-C&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{tempC}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:temperature</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;temp-K&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;temp-F&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{tempF}</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='div op'>/</span><span class='float val'>1.8</span><span class='comma token'>,</span> <span class='symbol val'>:temperature</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;temp-K&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;temp-R&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{tempR}</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='div op'>/</span><span class='float val'>1.8</span><span class='comma token'>,</span> <span class='symbol val'>:temperature</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;temp-K&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  
  <span class='comment val'>#time</span>
  <span class='string val'>'&lt;second&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{s sec second seconds}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:time</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;minute&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{min minute minutes}</span><span class='comma token'>,</span> <span class='float val'>60.0</span><span class='comma token'>,</span> <span class='symbol val'>:time</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>  
  <span class='string val'>'&lt;hour&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{h hr hrs hour hours}</span><span class='comma token'>,</span> <span class='float val'>3600.0</span><span class='comma token'>,</span> <span class='symbol val'>:time</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>  
  <span class='string val'>'&lt;day&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{d day days}</span><span class='comma token'>,</span> <span class='integer val'>3600</span><span class='mult op'>*</span><span class='integer val'>24</span><span class='comma token'>,</span> <span class='symbol val'>:time</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;week&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{wk week weeks}</span><span class='comma token'>,</span> <span class='integer val'>7</span><span class='mult op'>*</span><span class='integer val'>3600</span><span class='mult op'>*</span><span class='integer val'>24</span><span class='comma token'>,</span> <span class='symbol val'>:time</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;fortnight&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{fortnight fortnights}</span><span class='comma token'>,</span> <span class='integer val'>1209600</span><span class='comma token'>,</span> <span class='symbol val'>:time</span><span class='comma token'>,</span> <span class='dstring node'>%W{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;year&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{y yr year years annum}</span><span class='comma token'>,</span> <span class='integer val'>31556926</span><span class='comma token'>,</span> <span class='symbol val'>:time</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;decade&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='dstring node'>%w{decade decades}</span><span class='comma token'>,</span> <span class='integer val'>315569260</span><span class='comma token'>,</span> <span class='symbol val'>:time</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;century&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='dstring node'>%w{century centuries}</span><span class='comma token'>,</span> <span class='integer val'>3155692600</span><span class='comma token'>,</span> <span class='symbol val'>:time</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#pressure</span>
  <span class='string val'>'&lt;pascal&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{Pa pascal Pascal}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:pressure</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;meter&gt; &lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;bar&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{bar bars}</span><span class='comma token'>,</span> <span class='integer val'>100000</span><span class='comma token'>,</span> <span class='symbol val'>:pressure</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;meter&gt; &lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;mmHg&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{mmHg}</span><span class='comma token'>,</span> <span class='float val'>133.322368</span><span class='comma token'>,</span><span class='symbol val'>:pressure</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;meter&gt; &lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;inHg&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{inHg}</span><span class='comma token'>,</span> <span class='float val'>3386.3881472</span><span class='comma token'>,</span><span class='symbol val'>:pressure</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;meter&gt; &lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;torr&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{torr}</span><span class='comma token'>,</span> <span class='float val'>133.322368</span><span class='comma token'>,</span><span class='symbol val'>:pressure</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;meter&gt; &lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;bar&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{bar}</span><span class='comma token'>,</span> <span class='integer val'>100000</span><span class='comma token'>,</span><span class='symbol val'>:pressure</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;meter&gt; &lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;atm&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{atm ATM atmosphere atmospheres}</span><span class='comma token'>,</span> <span class='integer val'>101325</span><span class='comma token'>,</span><span class='symbol val'>:pressure</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;meter&gt; &lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;psi&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{psi}</span><span class='comma token'>,</span> <span class='float val'>6894.76</span><span class='comma token'>,</span><span class='symbol val'>:pressure</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;meter&gt; &lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;cmh2o&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{cmH2O}</span><span class='comma token'>,</span> <span class='float val'>98.0638</span><span class='comma token'>,</span><span class='symbol val'>:pressure</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;meter&gt; &lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;inh2o&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{inH2O}</span><span class='comma token'>,</span> <span class='float val'>249.082052</span><span class='comma token'>,</span><span class='symbol val'>:pressure</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;meter&gt; &lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  
  <span class='comment val'>#viscosity</span>
  <span class='string val'>'&lt;poise&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{P poise}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.1</span><span class='comma token'>,</span> <span class='symbol val'>:viscosity</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;meter&gt; &lt;second&gt;}</span> <span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;stokes&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{St stokes}</span><span class='comma token'>,</span> <span class='float val'>1e-4</span><span class='comma token'>,</span> <span class='symbol val'>:viscosity</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#substance</span>
  <span class='string val'>'&lt;mole&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{mol mole}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:substance</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;mole&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#concentration</span>
  <span class='string val'>'&lt;molar&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{M molar}</span><span class='comma token'>,</span> <span class='integer val'>1000</span><span class='comma token'>,</span> <span class='symbol val'>:concentration</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;mole&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;wtpercent&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{wt% wtpercent}</span><span class='comma token'>,</span> <span class='integer val'>10</span><span class='comma token'>,</span> <span class='symbol val'>:concentration</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#activity</span>
  <span class='string val'>'&lt;katal&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{kat katal Katal}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:activity</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;mole&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;unit&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{U enzUnit}</span><span class='comma token'>,</span> <span class='float val'>16.667e-16</span><span class='comma token'>,</span> <span class='symbol val'>:activity</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;mole&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#capacitance</span>
  <span class='string val'>'&lt;farad&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{F farad Farad}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:capacitance</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;farad&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#charge</span>
  <span class='string val'>'&lt;coulomb&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{C coulomb Coulomb}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:charge</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;ampere&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#current</span>
  <span class='string val'>'&lt;ampere&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{A Ampere ampere amp amps}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:current</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;ampere&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#conductance</span>
  <span class='string val'>'&lt;siemens&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{S Siemens siemens}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:resistance</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt; &lt;second&gt; &lt;ampere&gt; &lt;ampere&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt; &lt;meter&gt; &lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#inductance</span>
  <span class='string val'>'&lt;henry&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{H Henry henry}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:inductance</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;kilogram&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt; &lt;ampere&gt; &lt;ampere&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#potential</span>
  <span class='string val'>'&lt;volt&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{V Volt volt volts}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:potential</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;kilogram&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt; &lt;second&gt; &lt;ampere&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#resistance</span>
  <span class='string val'>'&lt;ohm&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{Ohm ohm}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:resistance</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;kilogram&gt;}</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;second&gt; &lt;second&gt; &lt;second&gt; &lt;ampere&gt; &lt;ampere&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#magnetism</span>
  <span class='string val'>'&lt;weber&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{Wb weber webers}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:magnetism</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;kilogram&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt; &lt;ampere&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;tesla&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{T tesla teslas}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:magnetism</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt; &lt;ampere&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;gauss&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{G gauss}</span><span class='comma token'>,</span> <span class='float val'>1e-4</span><span class='comma token'>,</span> <span class='symbol val'>:magnetism</span><span class='comma token'>,</span>  <span class='dstring node'>%w{&lt;kilogram&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt; &lt;ampere&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;maxwell&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{Mx maxwell maxwells}</span><span class='comma token'>,</span> <span class='float val'>1e-8</span><span class='comma token'>,</span> <span class='symbol val'>:magnetism</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;kilogram&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt; &lt;ampere&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;oersted&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{Oe oersted oersteds}</span><span class='comma token'>,</span> <span class='float val'>250.0</span><span class='div op'>/</span><span class='Math constant id'>Math</span><span class='colon2 op'>::</span><span class='PI constant id'>PI</span><span class='comma token'>,</span> <span class='symbol val'>:magnetism</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;ampere&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#energy</span>
  <span class='string val'>'&lt;joule&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{J joule Joule joules}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:energy</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;kilogram&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;erg&gt;'</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{erg ergs}</span><span class='comma token'>,</span> <span class='float val'>1e-7</span><span class='comma token'>,</span> <span class='symbol val'>:energy</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;kilogram&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;btu&gt;'</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{BTU btu BTUs}</span><span class='comma token'>,</span> <span class='float val'>1055.056</span><span class='comma token'>,</span> <span class='symbol val'>:energy</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;kilogram&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;calorie&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{cal calorie calories}</span><span class='comma token'>,</span> <span class='float val'>4.18400</span><span class='comma token'>,</span> <span class='symbol val'>:energy</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;kilogram&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;Calorie&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{Cal Calorie Calories}</span><span class='comma token'>,</span> <span class='float val'>4184.00</span><span class='comma token'>,</span> <span class='symbol val'>:energy</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;kilogram&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;therm-US&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{th therm therms Therm}</span><span class='comma token'>,</span> <span class='integer val'>105480400</span><span class='comma token'>,</span> <span class='symbol val'>:energy</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt; &lt;kilogram&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#force</span>
  <span class='string val'>'&lt;newton&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{N Newton newton}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:force</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt; &lt;meter&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;dyne&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{dyn dyne}</span><span class='comma token'>,</span> <span class='float val'>1e-5</span><span class='comma token'>,</span> <span class='symbol val'>:force</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt; &lt;meter&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;pound-force&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{lbf pound-force}</span><span class='comma token'>,</span> <span class='float val'>4.448222</span><span class='comma token'>,</span> <span class='symbol val'>:force</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt; &lt;meter&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#frequency</span>
  <span class='string val'>'&lt;hertz&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{Hz hertz Hertz}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:frequency</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;1&gt;}</span><span class='comma token'>,</span> <span class='string val'>%{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#angle</span>
  <span class='string val'>'&lt;radian&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='dstring node'>%w{rad radian radian}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:angle</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;radian&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;degree&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='dstring node'>%w{deg degree degrees}</span><span class='comma token'>,</span> <span class='Math constant id'>Math</span><span class='colon2 op'>::</span><span class='PI constant id'>PI</span> <span class='div op'>/</span> <span class='float val'>180.0</span><span class='comma token'>,</span> <span class='symbol val'>:angle</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;radian&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;grad&gt;'</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='dstring node'>%w{grad gradian grads}</span><span class='comma token'>,</span> <span class='Math constant id'>Math</span><span class='colon2 op'>::</span><span class='PI constant id'>PI</span> <span class='div op'>/</span> <span class='float val'>200.0</span><span class='comma token'>,</span> <span class='symbol val'>:angle</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;radian&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;steradian&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{sr steradian steradians}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:solid_angle</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;steradian&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#rotation</span>
  <span class='string val'>'&lt;rotation&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{rotation}</span><span class='comma token'>,</span> <span class='float val'>2.0</span><span class='mult op'>*</span><span class='Math constant id'>Math</span><span class='colon2 op'>::</span><span class='PI constant id'>PI</span><span class='comma token'>,</span> <span class='symbol val'>:angle</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;radian&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;rpm&gt;'</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='dstring node'>%w{rpm}</span><span class='comma token'>,</span> <span class='float val'>2.0</span><span class='mult op'>*</span><span class='Math constant id'>Math</span><span class='colon2 op'>::</span><span class='PI constant id'>PI</span> <span class='div op'>/</span> <span class='float val'>60.0</span><span class='comma token'>,</span> <span class='symbol val'>:angular_velocity</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;radian&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#memory</span>
  <span class='string val'>'&lt;byte&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='dstring node'>%w{B byte}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:memory</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;byte&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;bit&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='dstring node'>%w{b bit}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.125</span><span class='comma token'>,</span> <span class='symbol val'>:memory</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;byte&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#currency</span>
  <span class='string val'>'&lt;dollar&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='dstring node'>%w{USD dollar}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:currency</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;dollar&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;cents&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='dstring node'>%w{cents}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.01</span><span class='comma token'>,</span> <span class='symbol val'>:currency</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;dollar&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#luminosity</span>
  <span class='string val'>'&lt;candela&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{cd candela}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:luminosity</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;candela&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;lumen&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{lm lumen}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:luminous_power</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;candela&gt; &lt;steradian&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;lux&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='dstring node'>%w{lux}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:illuminance</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;candela&gt; &lt;steradian&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#power</span>
  <span class='string val'>'&lt;watt&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{W watt watts}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:power</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt; &lt;meter&gt; &lt;meter&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;horsepower&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{hp horsepower}</span><span class='comma token'>,</span> <span class='float val'>745.699872</span><span class='comma token'>,</span> <span class='symbol val'>:power</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;kilogram&gt; &lt;meter&gt; &lt;meter&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#radiation</span>
  <span class='string val'>'&lt;gray&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{Gy gray grays}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:radiation</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;roentgen&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{R roentgen}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.009330</span><span class='comma token'>,</span> <span class='symbol val'>:radiation</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;sievert&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{Sv sievert sieverts}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:radiation</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt; &lt;meter&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;second&gt; &lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;becquerel&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{Bq bequerel bequerels}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:radiation</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;1&gt;}</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;curie&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{Ci curie curies}</span><span class='comma token'>,</span> <span class='float val'>3.7e10</span><span class='comma token'>,</span> <span class='symbol val'>:radiation</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;1&gt;}</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  
  <span class='comment val'># rate</span>
  <span class='string val'>'&lt;cpm&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{cpm}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='div op'>/</span><span class='float val'>60.0</span><span class='comma token'>,</span> <span class='symbol val'>:rate</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;count&gt;}</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;dpm&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{dpm}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='div op'>/</span><span class='float val'>60.0</span><span class='comma token'>,</span> <span class='symbol val'>:rate</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;count&gt;}</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;bpm&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{bpm}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='div op'>/</span><span class='float val'>60.0</span><span class='comma token'>,</span> <span class='symbol val'>:rate</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;count&gt;}</span><span class='comma token'>,</span><span class='dstring node'>%w{&lt;second&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#resolution / typography</span>
  <span class='string val'>'&lt;dot&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{dot dots}</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='symbol val'>:resolution</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;each&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;pixel&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{pixel px}</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='symbol val'>:resolution</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;each&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;ppi&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{ppi}</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='symbol val'>:resolution</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;pixel&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;inch&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;dpi&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{dpi}</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='symbol val'>:typography</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;dot&gt;}</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;inch&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;pica&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{pica}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.00423333333</span> <span class='comma token'>,</span> <span class='symbol val'>:typography</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;point&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{point pt}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.000352777778</span><span class='comma token'>,</span> <span class='symbol val'>:typography</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;meter&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>

  <span class='comment val'>#other</span>
  <span class='string val'>'&lt;cell&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{cells cell}</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='symbol val'>:counting</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;each&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;each&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{each}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:counting</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;each&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;count&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{count}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:counting</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;each&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>  
  <span class='string val'>'&lt;base-pair&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{bp}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:counting</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;each&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;nucleotide&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{nt}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:counting</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;each&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;molecule&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{molecule molecules}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:counting</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;1&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;dozen&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{doz dz dozen}</span><span class='comma token'>,</span><span class='float val'>12.0</span><span class='comma token'>,</span><span class='symbol val'>:prefix_only</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;each&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;percent&gt;'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{% percent}</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.01</span><span class='comma token'>,</span> <span class='symbol val'>:prefix_only</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;1&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;ppm&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{ppm}</span><span class='comma token'>,</span><span class='float val'>1e-6</span><span class='comma token'>,</span><span class='symbol val'>:prefix_only</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;1&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;ppt&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{ppt}</span><span class='comma token'>,</span><span class='float val'>1e-9</span><span class='comma token'>,</span><span class='symbol val'>:prefix_only</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;1&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;gross&gt;'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='lbrack token'>[</span><span class='dstring node'>%w{gr gross}</span><span class='comma token'>,</span><span class='float val'>144.0</span><span class='comma token'>,</span> <span class='symbol val'>:prefix_only</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;dozen&gt; &lt;dozen&gt;}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='string val'>'&lt;decibel&gt;'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>%w{dB decibel decibels}</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='symbol val'>:logarithmic</span><span class='comma token'>,</span> <span class='dstring node'>%w{&lt;decibel&gt;}</span><span class='rbrack token'>]</span>


<span class='rbrace token'>}</span>
</pre></dd>
      
        <dt id="VERSION-constant" class="">VERSION =
            <span class="summary_desc">pre-generate hashes from unit definitions for performance.</span>
        </dt>
        <dd><pre class="code"><span class='string val'>'1.1.5'</span>
</pre></dd>
      
        <dt id="UNITY-constant" class="">UNITY =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='string val'>'&lt;1&gt;'</span>
</pre></dd>
      
        <dt id="UNITY_ARRAY-constant" class="">UNITY_ARRAY =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='lbrack token'>[</span><span class='UNITY constant id'>UNITY</span><span class='rbrack token'>]</span>
</pre></dd>
      
        <dt id="FEET_INCH_REGEX-constant" class="">FEET_INCH_REGEX =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='regexp val'>/(\d+)\s*(?:'|ft|feet)\s*(\d+)\s*(?:&quot;|in|inches)/</span>
</pre></dd>
      
        <dt id="TIME_REGEX-constant" class="">TIME_REGEX =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='regexp val'>/(\d+)*:(\d+)*:*(\d+)*[:,]*(\d+)*/</span>
</pre></dd>
      
        <dt id="LBS_OZ_REGEX-constant" class="">LBS_OZ_REGEX =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='regexp val'>/(\d+)\s*(?:#|lbs|pounds|pound-mass)+[\s,]*(\d+)\s*(?:oz|ounces)/</span>
</pre></dd>
      
        <dt id="SCI_NUMBER-constant" class="">SCI_NUMBER =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='regexp val'>%r{([+-]?\d*[.]?\d+(?:[Ee][+-]?)?\d*)}</span>
</pre></dd>
      
        <dt id="RATIONAL_NUMBER-constant" class="">RATIONAL_NUMBER =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='regexp val'>/(\d+)\/(\d+)/</span>
</pre></dd>
      
        <dt id="COMPLEX_NUMBER-constant" class="">COMPLEX_NUMBER =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='dregexp node'>/#{SCI_NUMBER}?#{SCI_NUMBER}i\b/</span>
</pre></dd>
      
        <dt id="NUMBER_REGEX-constant" class="">NUMBER_REGEX =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='dregexp node'>/#{SCI_NUMBER}*\s*(.+)?/</span>
</pre></dd>
      
        <dt id="UNIT_STRING_REGEX-constant" class="">UNIT_STRING_REGEX =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='dregexp node'>/#{SCI_NUMBER}*\s*([^\/]*)\/*(.+)*/</span>
</pre></dd>
      
        <dt id="TOP_REGEX-constant" class="">TOP_REGEX =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='regexp val'>/([^ \*]+)(?:\^|\*\*)([\d-]+)/</span>
</pre></dd>
      
        <dt id="BOTTOM_REGEX-constant" class="">BOTTOM_REGEX =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='regexp val'>/([^* ]+)(?:\^|\*\*)(\d+)/</span>
</pre></dd>
      
        <dt id="UNCERTAIN_REGEX-constant" class="">UNCERTAIN_REGEX =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='dregexp node'>/#{SCI_NUMBER}\s*\+\/-\s*#{SCI_NUMBER}\s(.+)/</span>
</pre></dd>
      
        <dt id="COMPLEX_REGEX-constant" class="">COMPLEX_REGEX =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='dregexp node'>/#{COMPLEX_NUMBER}\s?(.+)?/</span>
</pre></dd>
      
        <dt id="RATIONAL_REGEX-constant" class="">RATIONAL_REGEX =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='dregexp node'>/#{RATIONAL_NUMBER}\s?(.+)?/</span>
</pre></dd>
      
        <dt id="KELVIN-constant" class="">KELVIN =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='lbrack token'>[</span><span class='string val'>'&lt;kelvin&gt;'</span><span class='rbrack token'>]</span>
</pre></dd>
      
        <dt id="FAHRENHEIT-constant" class="">FAHRENHEIT =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='lbrack token'>[</span><span class='string val'>'&lt;fahrenheit&gt;'</span><span class='rbrack token'>]</span>
</pre></dd>
      
        <dt id="RANKINE-constant" class="">RANKINE =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='lbrack token'>[</span><span class='string val'>'&lt;rankine&gt;'</span><span class='rbrack token'>]</span>
</pre></dd>
      
        <dt id="CELSIUS-constant" class="">CELSIUS =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='lbrack token'>[</span><span class='string val'>'&lt;celsius&gt;'</span><span class='rbrack token'>]</span>
</pre></dd>
      
        <dt id="SIGNATURE_VECTOR-constant" class="">SIGNATURE_VECTOR =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='lbrack token'>[</span><span class='symbol val'>:length</span><span class='comma token'>,</span> <span class='symbol val'>:time</span><span class='comma token'>,</span> <span class='symbol val'>:temperature</span><span class='comma token'>,</span> <span class='symbol val'>:mass</span><span class='comma token'>,</span> <span class='symbol val'>:current</span><span class='comma token'>,</span> <span class='symbol val'>:substance</span><span class='comma token'>,</span> <span class='symbol val'>:luminosity</span><span class='comma token'>,</span> <span class='symbol val'>:currency</span><span class='comma token'>,</span> <span class='symbol val'>:memory</span><span class='comma token'>,</span> <span class='symbol val'>:angle</span><span class='comma token'>,</span> <span class='symbol val'>:capacitance</span><span class='rbrack token'>]</span>
</pre></dd>
      
        <dt id="USER_DEFINITIONS-classvariable" class="">@@USER_DEFINITIONS =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='lbrace token'>{</span><span class='rbrace token'>}</span>
</pre></dd>
      
        <dt id="PREFIX_VALUES-classvariable" class="">@@PREFIX_VALUES =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='lbrace token'>{</span><span class='rbrace token'>}</span>
</pre></dd>
      
        <dt id="PREFIX_MAP-classvariable" class="">@@PREFIX_MAP =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='lbrace token'>{</span><span class='rbrace token'>}</span>
</pre></dd>
      
        <dt id="UNIT_MAP-classvariable" class="">@@UNIT_MAP =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='lbrace token'>{</span><span class='rbrace token'>}</span>
</pre></dd>
      
        <dt id="UNIT_VALUES-classvariable" class="">@@UNIT_VALUES =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='lbrace token'>{</span><span class='rbrace token'>}</span>
</pre></dd>
      
        <dt id="OUTPUT_MAP-classvariable" class="">@@OUTPUT_MAP =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='lbrace token'>{</span><span class='rbrace token'>}</span>
</pre></dd>
      
        <dt id="BASE_UNITS-classvariable" class="">@@BASE_UNITS =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='lbrack token'>[</span><span class='string val'>'&lt;meter&gt;'</span><span class='comma token'>,</span><span class='string val'>'&lt;kilogram&gt;'</span><span class='comma token'>,</span><span class='string val'>'&lt;second&gt;'</span><span class='comma token'>,</span><span class='string val'>'&lt;mole&gt;'</span><span class='comma token'>,</span> <span class='string val'>'&lt;farad&gt;'</span><span class='comma token'>,</span> <span class='string val'>'&lt;ampere&gt;'</span><span class='comma token'>,</span><span class='string val'>'&lt;radian&gt;'</span><span class='comma token'>,</span><span class='string val'>'&lt;kelvin&gt;'</span><span class='comma token'>,</span><span class='string val'>'&lt;temp-K&gt;'</span><span class='comma token'>,</span><span class='string val'>'&lt;byte&gt;'</span><span class='comma token'>,</span><span class='string val'>'&lt;dollar&gt;'</span><span class='comma token'>,</span><span class='string val'>'&lt;candela&gt;'</span><span class='comma token'>,</span><span class='string val'>'&lt;each&gt;'</span><span class='comma token'>,</span><span class='string val'>'&lt;steradian&gt;'</span><span class='comma token'>,</span><span class='string val'>'&lt;decibel&gt;'</span><span class='rbrack token'>]</span>
</pre></dd>
      
        <dt id="KINDS-classvariable" class="">@@KINDS =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='lbrace token'>{</span>
<span class='integer val'>-312058</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:resistance</span><span class='comma token'>,</span> 
<span class='integer val'>-312038</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:inductance</span><span class='comma token'>,</span> 
<span class='integer val'>-152040</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:magnetism</span><span class='comma token'>,</span> 
<span class='integer val'>-152038</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:magnetism</span><span class='comma token'>,</span> 
<span class='integer val'>-152058</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:potential</span><span class='comma token'>,</span> 
<span class='integer val'>-39</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:acceleration</span><span class='comma token'>,</span>
<span class='integer val'>-38</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:radiation</span><span class='comma token'>,</span> 
<span class='integer val'>-20</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:frequency</span><span class='comma token'>,</span> 
<span class='integer val'>-19</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:speed</span><span class='comma token'>,</span> 
<span class='integer val'>-18</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:viscosity</span><span class='comma token'>,</span> 
<span class='integer val'>0</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:unitless</span><span class='comma token'>,</span> 
<span class='integer val'>1</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:length</span><span class='comma token'>,</span> 
<span class='integer val'>2</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:area</span><span class='comma token'>,</span> 
<span class='integer val'>3</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:volume</span><span class='comma token'>,</span> 
<span class='integer val'>20</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:time</span><span class='comma token'>,</span> 
<span class='integer val'>400</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:temperature</span><span class='comma token'>,</span> 
<span class='integer val'>7942</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:power</span><span class='comma token'>,</span> 
<span class='integer val'>7959</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:pressure</span><span class='comma token'>,</span> 
<span class='integer val'>7962</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:energy</span><span class='comma token'>,</span> 
<span class='integer val'>7979</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:viscosity</span><span class='comma token'>,</span> 
<span class='integer val'>7961</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:force</span><span class='comma token'>,</span> 
<span class='integer val'>7997</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:mass_concentration</span><span class='comma token'>,</span>
<span class='integer val'>8000</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:mass</span><span class='comma token'>,</span> 
<span class='integer val'>159999</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:magnetism</span><span class='comma token'>,</span> 
<span class='integer val'>160000</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:current</span><span class='comma token'>,</span> 
<span class='integer val'>160020</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:charge</span><span class='comma token'>,</span> 
<span class='integer val'>312058</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:resistance</span><span class='comma token'>,</span> 
<span class='integer val'>3199980</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:activity</span><span class='comma token'>,</span> 
<span class='integer val'>3199997</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:molar_concentration</span><span class='comma token'>,</span> 
<span class='integer val'>3200000</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:substance</span><span class='comma token'>,</span> 
<span class='integer val'>63999998</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:illuminance</span><span class='comma token'>,</span> 
<span class='integer val'>64000000</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:luminous_power</span><span class='comma token'>,</span> 
<span class='integer val'>1280000000</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:currency</span><span class='comma token'>,</span> 
<span class='integer val'>25600000000</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:memory</span><span class='comma token'>,</span>
<span class='integer val'>511999999980</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:angular_velocity</span><span class='comma token'>,</span> 
<span class='integer val'>512000000000</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:angle</span><span class='comma token'>,</span> 
<span class='integer val'>10240000000000</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='symbol val'>:capacitance</span><span class='comma token'>,</span> 
<span class='rbrace token'>}</span>
</pre></dd>
      
        <dt id="cached_units-classvariable" class="">@@cached_units =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='lbrace token'>{</span><span class='rbrace token'>}</span>
</pre></dd>
      
        <dt id="base_unit_cache-classvariable" class="">@@base_unit_cache =
            <span class="summary_desc"></span>
        </dt>
        <dd><pre class="code"><span class='lbrace token'>{</span><span class='rbrace token'>}</span>
</pre></dd>
      
    </dl>
  


  
  
  
  

  <h2>Class Method Summary</h2>

  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#setup-class_method" title="setup (class method)">+ (Object) <strong>setup</strong> </a>
    

    
  </span>
  
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
  </ul>

  
  
  
  
  
  <h3 class="inherited">Methods inherited from <a href="Numeric.html" title="Numeric (class)">Numeric</a></h3>
  <p class="inherited"><a href="Numeric.html#to_unit-instance_method" title="Numeric#to_unit (method)">#to_unit</a></p>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="setup-class_method">
  
    + (<tt><a href="Object.html" title="Object (class)">Object</a></tt>) <strong>setup</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968
969
970
971
972
973
974
975
976
977
978
979
980
981
982
983
984
985
986
987
988
989
990
991
992
993
994
995
996
997
998
999
1000
1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025
1026
1027
1028
1029
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039
1040
1041
1042
1043
1044
1045
1046
1047
1048
1049
1050
1051
1052
1053
1054
1055
1056
1057
1058
1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1069
1070
1071
1072
1073
1074
1075
1076
1077
1078
1079
1080
1081
1082
1083
1084
1085
1086
1087
1088
1089
1090
1091
1092
1093
1094
1095
1096
1097
1098
1099
1100
1101
1102
1103
1104
1105
1106
1107
1108
1109
1110
1111
1112
1113
1114
1115
1116
1117</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ruby_units/ruby-units.rb', line 115</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='setup identifier id'>setup</span>
    <span class='@@ALL_UNIT_DEFINITIONS ivar id'>@@ALL_UNIT_DEFINITIONS</span> <span class='assign token'>=</span> <span class='UNIT_DEFINITIONS constant id'>UNIT_DEFINITIONS</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='@@USER_DEFINITIONS ivar id'>@@USER_DEFINITIONS</span><span class='rparen token'>)</span>
    <span class='for for kw'>for</span> <span class='unit identifier id'>unit</span> <span class='in in kw'>in</span> <span class='lparen token'>(</span><span class='@@ALL_UNIT_DEFINITIONS ivar id'>@@ALL_UNIT_DEFINITIONS</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
      <span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='unit identifier id'>unit</span>
      <span class='if if kw'>if</span> <span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='symbol val'>:prefix</span> <span class='then then kw'>then</span>
        <span class='@@PREFIX_VALUES ivar id'>@@PREFIX_VALUES</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
        <span class='for for kw'>for</span> <span class='name identifier id'>name</span> <span class='in in kw'>in</span> <span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='do do kw'>do</span>
          <span class='@@PREFIX_MAP ivar id'>@@PREFIX_MAP</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='key identifier id'>key</span>
        <span class='end end kw'>end</span>    
      <span class='else else kw'>else</span>
        <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span>
        <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:scalar</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
        <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:numerator</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span>
        <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:denominator</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='integer val'>4</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='integer val'>4</span><span class='rbrack token'>]</span>
        <span class='for for kw'>for</span> <span class='name identifier id'>name</span> <span class='in in kw'>in</span> <span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='do do kw'>do</span>
          <span class='@@UNIT_MAP ivar id'>@@UNIT_MAP</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='key identifier id'>key</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
      <span class='@@OUTPUT_MAP ivar id'>@@OUTPUT_MAP</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>        
    <span class='end end kw'>end</span>
    <span class='@@PREFIX_REGEX ivar id'>@@PREFIX_REGEX</span> <span class='assign token'>=</span> <span class='@@PREFIX_MAP ivar id'>@@PREFIX_MAP</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='sort_by identifier id'>sort_by</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='prefix identifier id'>prefix</span><span class='bitor op'>|</span> <span class='lbrack token'>[</span><span class='prefix identifier id'>prefix</span><span class='dot token'>.</span><span class='length identifier id'>length</span><span class='comma token'>,</span> <span class='prefix identifier id'>prefix</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='reverse identifier id'>reverse</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>'|'</span><span class='rparen token'>)</span>
    <span class='@@UNIT_REGEX ivar id'>@@UNIT_REGEX</span> <span class='assign token'>=</span> <span class='@@UNIT_MAP ivar id'>@@UNIT_MAP</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='sort_by identifier id'>sort_by</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='unit identifier id'>unit</span><span class='bitor op'>|</span> <span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='dot token'>.</span><span class='length identifier id'>length</span><span class='comma token'>,</span> <span class='unit identifier id'>unit</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='reverse identifier id'>reverse</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>'|'</span><span class='rparen token'>)</span>
    <span class='@@UNIT_MATCH_REGEX ivar id'>@@UNIT_MATCH_REGEX</span> <span class='assign token'>=</span> <span class='dregexp node'>/(#{@@PREFIX_REGEX})*?(#{@@UNIT_REGEX})\b/</span>    
    <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  
  <span class='include identifier id'>include</span> <span class='Comparable constant id'>Comparable</span>
  <span class='attr_accessor identifier id'>attr_accessor</span> <span class='symbol val'>:scalar</span><span class='comma token'>,</span> <span class='symbol val'>:numerator</span><span class='comma token'>,</span> <span class='symbol val'>:denominator</span><span class='comma token'>,</span> <span class='symbol val'>:signature</span><span class='comma token'>,</span> <span class='symbol val'>:base_scalar</span><span class='comma token'>,</span> <span class='symbol val'>:base_numerator</span><span class='comma token'>,</span> <span class='symbol val'>:base_denominator</span><span class='comma token'>,</span> <span class='symbol val'>:output</span><span class='comma token'>,</span> <span class='symbol val'>:unit_name</span>

  <span class='def def kw'>def</span> <span class='to_yaml_properties identifier id'>to_yaml_properties</span>
    <span class='dstring node'>%w{@scalar @numerator @denominator @signature @base_scalar}</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># needed to make complex units play nice -- otherwise not detected as a complex_generic</span>
 
  <span class='def def kw'>def</span> <span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='klass identifier id'>klass</span><span class='rparen token'>)</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='klass identifier id'>klass</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
 
  <span class='def def kw'>def</span> <span class='copy identifier id'>copy</span><span class='lparen token'>(</span><span class='from identifier id'>from</span><span class='rparen token'>)</span>
    <span class='@scalar ivar id'>@scalar</span> <span class='assign token'>=</span> <span class='from identifier id'>from</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span>
    <span class='@numerator ivar id'>@numerator</span> <span class='assign token'>=</span> <span class='from identifier id'>from</span><span class='dot token'>.</span><span class='numerator identifier id'>numerator</span>
    <span class='@denominator ivar id'>@denominator</span> <span class='assign token'>=</span> <span class='from identifier id'>from</span><span class='dot token'>.</span><span class='denominator identifier id'>denominator</span>
    <span class='@is_base ivar id'>@is_base</span> <span class='assign token'>=</span> <span class='from identifier id'>from</span><span class='dot token'>.</span><span class='is_base? fid id'>is_base?</span>
    <span class='@signature ivar id'>@signature</span> <span class='assign token'>=</span> <span class='from identifier id'>from</span><span class='dot token'>.</span><span class='signature identifier id'>signature</span>
    <span class='@base_scalar ivar id'>@base_scalar</span> <span class='assign token'>=</span> <span class='from identifier id'>from</span><span class='dot token'>.</span><span class='base_scalar identifier id'>base_scalar</span>
    <span class='@unit_name ivar id'>@unit_name</span> <span class='assign token'>=</span> <span class='from identifier id'>from</span><span class='dot token'>.</span><span class='unit_name identifier id'>unit_name</span> <span class='rescue rescue kw'>rescue</span> <span class='nil nil kw'>nil</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># basically a copy of the basic to_yaml.  Needed because otherwise it ends up coercing the object to a string</span>
  <span class='comment val'># before YAML'izing it.</span>
  <span class='def def kw'>def</span> <span class='to_yaml identifier id'>to_yaml</span><span class='lparen token'>(</span> <span class='opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span> <span class='rparen token'>)</span>
    <span class='YAML constant id'>YAML</span><span class='colon2 op'>::</span><span class='quick_emit identifier id'>quick_emit</span><span class='lparen token'>(</span> <span class='object_id identifier id'>object_id</span><span class='comma token'>,</span> <span class='opts identifier id'>opts</span> <span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='out identifier id'>out</span><span class='bitor op'>|</span>
      <span class='out identifier id'>out</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lparen token'>(</span> <span class='taguri identifier id'>taguri</span><span class='comma token'>,</span> <span class='to_yaml_style identifier id'>to_yaml_style</span> <span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='map identifier id'>map</span><span class='bitor op'>|</span>
        <span class='for for kw'>for</span> <span class='m identifier id'>m</span> <span class='in in kw'>in</span> <span class='to_yaml_properties identifier id'>to_yaml_properties</span> <span class='do do kw'>do</span> 
          <span class='map identifier id'>map</span><span class='dot token'>.</span><span class='add identifier id'>add</span><span class='lparen token'>(</span> <span class='m identifier id'>m</span><span class='lbrack token'>[</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='integer val'>-1</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='instance_variable_get identifier id'>instance_variable_get</span><span class='lparen token'>(</span> <span class='m identifier id'>m</span> <span class='rparen token'>)</span> <span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># Create a new Unit object.  Can be initialized using a string, or a hash</span>
  <span class='comment val'># Valid formats include:</span>
  <span class='comment val'>#  &quot;5.6 kg*m/s^2&quot;</span>
  <span class='comment val'>#  &quot;5.6 kg*m*s^-2&quot;</span>
  <span class='comment val'>#  &quot;5.6 kilogram*meter*second^-2&quot;</span>
  <span class='comment val'>#  &quot;2.2 kPa&quot;</span>
  <span class='comment val'>#  &quot;37 degC&quot;</span>
  <span class='comment val'>#  &quot;1&quot;  -- creates a unitless constant with value 1</span>
  <span class='comment val'>#  &quot;GPa&quot;  -- creates a unit with scalar 1 with units 'GPa'</span>
  <span class='comment val'>#  6'4&quot;  -- recognized as 6 feet + 4 inches </span>
  <span class='comment val'>#  8 lbs 8 oz -- recognized as 8 lbs + 8 ounces</span>
  <span class='comment val'>#</span>
  <span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>
    <span class='@scalar ivar id'>@scalar</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='@base_scalar ivar id'>@base_scalar</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='@unit_name ivar id'>@unit_name</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='@signature ivar id'>@signature</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='@output ivar id'>@output</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='eq op'>==</span> <span class='integer val'>2</span>
      <span class='begin begin kw'>begin</span>
        <span class='cached identifier id'>cached</span> <span class='assign token'>=</span> <span class='@@cached_units ivar id'>@@cached_units</span><span class='lbrack token'>[</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='mult op'>*</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> 
        <span class='copy identifier id'>copy</span><span class='lparen token'>(</span><span class='cached identifier id'>cached</span><span class='rparen token'>)</span>
      <span class='rescue rescue kw'>rescue</span> 
        <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{options[0]} #{(options[1].units rescue options[1])}&quot;</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
      <span class='return return kw'>return</span>
    <span class='end end kw'>end</span>
    <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='eq op'>==</span> <span class='integer val'>3</span>
      <span class='begin begin kw'>begin</span>
        <span class='cached identifier id'>cached</span> <span class='assign token'>=</span> <span class='@@cached_units ivar id'>@@cached_units</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;#{options[1]}/#{options[2]}&quot;</span><span class='rbrack token'>]</span> <span class='mult op'>*</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> 
        <span class='copy identifier id'>copy</span><span class='lparen token'>(</span><span class='cached identifier id'>cached</span><span class='rparen token'>)</span>
      <span class='rescue rescue kw'>rescue</span> 
        <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{options[0]} #{options[1]}/#{options[2]}&quot;</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
      <span class='return return kw'>return</span>
    <span class='end end kw'>end</span>
    
    <span class='case case kw'>case</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
    <span class='when when kw'>when</span> <span class='Hash constant id'>Hash</span><span class='colon op'>:</span>
      <span class='@scalar ivar id'>@scalar</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:scalar</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='integer val'>1</span>
      <span class='@numerator ivar id'>@numerator</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:numerator</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span>
      <span class='@denominator ivar id'>@denominator</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:denominator</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span>
      <span class='@signature ivar id'>@signature</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:signature</span><span class='rbrack token'>]</span>
    <span class='when when kw'>when</span> <span class='Array constant id'>Array</span><span class='colon op'>:</span>
      <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='return return kw'>return</span>
    <span class='when when kw'>when</span> <span class='Numeric constant id'>Numeric</span><span class='colon op'>:</span>
      <span class='@scalar ivar id'>@scalar</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
      <span class='@numerator ivar id'>@numerator</span> <span class='assign token'>=</span> <span class='@denominator ivar id'>@denominator</span> <span class='assign token'>=</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span>
    <span class='when when kw'>when</span> <span class='Time constant id'>Time</span><span class='colon op'>:</span>
      <span class='@scalar ivar id'>@scalar</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span>
      <span class='@numerator ivar id'>@numerator</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='string val'>'&lt;second&gt;'</span><span class='rbrack token'>]</span>
      <span class='@denominator ivar id'>@denominator</span> <span class='assign token'>=</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span>
    <span class='when when kw'>when</span> <span class='DateTime constant id'>DateTime</span><span class='colon op'>:</span>
      <span class='@scalar ivar id'>@scalar</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='ajd identifier id'>ajd</span>
      <span class='@numerator ivar id'>@numerator</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='string val'>'&lt;day&gt;'</span><span class='rbrack token'>]</span>
      <span class='@denominator ivar id'>@denominator</span> <span class='assign token'>=</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span>
    <span class='when when kw'>when</span> <span class='string val'>&quot;&quot;</span><span class='colon op'>:</span> 
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;No Unit Specified&quot;</span>
    <span class='when when kw'>when</span> <span class='String constant id'>String</span><span class='colon op'>:</span> 
      <span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>   
    <span class='else else kw'>else</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Invalid Unit Format&quot;</span>
    <span class='end end kw'>end</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='update_base_scalar identifier id'>update_base_scalar</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Temperature out of range&quot;</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='is_temperature? fid id'>is_temperature?</span> <span class='andop op'>&amp;&amp;</span>  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='base_scalar identifier id'>base_scalar</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span>
  
    <span class='unary_unit identifier id'>unary_unit</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='units identifier id'>units</span> <span class='orop op'>||</span> <span class='string val'>&quot;&quot;</span>
    <span class='opt_units identifier id'>opt_units</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='NUMBER_REGEX constant id'>NUMBER_REGEX</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='String constant id'>String</span> <span class='eqq op'>===</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
    <span class='unless unless kw'>unless</span> <span class='@@cached_units ivar id'>@@cached_units</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='opt_units identifier id'>opt_units</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='opt_units identifier id'>opt_units</span> <span class='match op'>=~</span> <span class='dregexp node'>/(temp|deg(C|K|R|F))|(pounds|lbs[ ,]\d+ ounces|oz)|('\d+&quot;)|(ft|feet[ ,]\d+ in|inch|inches)|%|(#{TIME_REGEX})|i\s?(.+)?|&amp;plusmn;|\+\/-/</span><span class='rparen token'>)</span>
      <span class='@@cached_units ivar id'>@@cached_units</span><span class='lbrack token'>[</span><span class='opt_units identifier id'>opt_units</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span> <span class='eq op'>==</span> <span class='integer val'>1</span> <span class='question op'>?</span> <span class='self self kw'>self</span> <span class='colon op'>:</span> <span class='opt_units identifier id'>opt_units</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='opt_units identifier id'>opt_units</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='opt_units identifier id'>opt_units</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='end end kw'>end</span>
    <span class='unless unless kw'>unless</span> <span class='@@cached_units ivar id'>@@cached_units</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='unary_unit identifier id'>unary_unit</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='unary_unit identifier id'>unary_unit</span> <span class='match op'>=~</span> <span class='regexp val'>/(temp|deg)(C|K|R|F)/</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
      <span class='@@cached_units ivar id'>@@cached_units</span><span class='lbrack token'>[</span><span class='unary_unit identifier id'>unary_unit</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span> <span class='eq op'>==</span> <span class='integer val'>1</span> <span class='question op'>?</span> <span class='self self kw'>self</span> <span class='colon op'>:</span> <span class='unary_unit identifier id'>unary_unit</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='lbrack token'>[</span><span class='@scalar ivar id'>@scalar</span><span class='comma token'>,</span> <span class='@numerator ivar id'>@numerator</span><span class='comma token'>,</span> <span class='@denominator ivar id'>@denominator</span><span class='comma token'>,</span> <span class='@base_scalar ivar id'>@base_scalar</span><span class='comma token'>,</span> <span class='@signature ivar id'>@signature</span><span class='comma token'>,</span> <span class='@is_base ivar id'>@is_base</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='freeze identifier id'>freeze</span><span class='rbrace token'>}</span>
    <span class='self self kw'>self</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='kind identifier id'>kind</span>
    <span class='return return kw'>return</span> <span class='@@KINDS ivar id'>@@KINDS</span><span class='lbrack token'>[</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='signature identifier id'>signature</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
  
  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='cached identifier id'>cached</span>
    <span class='return return kw'>return</span> <span class='@@cached_units ivar id'>@@cached_units</span>
  <span class='end end kw'>end</span>
  
  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='clear_cache identifier id'>clear_cache</span>
    <span class='@@cached_units ivar id'>@@cached_units</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='@@base_unit_cache ivar id'>@@base_unit_cache</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
    
  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='base_unit_cache identifier id'>base_unit_cache</span>
    <span class='return return kw'>return</span> <span class='@@base_unit_cache ivar id'>@@base_unit_cache</span>
  <span class='end end kw'>end</span>
  
  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='input identifier id'>input</span><span class='rparen token'>)</span>
    <span class='first identifier id'>first</span><span class='comma token'>,</span> <span class='second identifier id'>second</span> <span class='assign token'>=</span> <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='regexp val'>/(.+)\s(?:in|to|as)\s(.+)/i</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
    <span class='second identifier id'>second</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='integer val'>? </span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span> <span class='colon op'>:</span> <span class='first identifier id'>first</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='second identifier id'>second</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='def def kw'>def</span> <span class='to_unit identifier id'>to_unit</span>
    <span class='self self kw'>self</span>
  <span class='end end kw'>end</span>
  <span class='alias alias kw'>alias</span> <span class='symbol val'>:unit</span> <span class='symbol val'>:to_unit</span>
  
  <span class='comment val'># Returns 'true' if the Unit is represented in base units</span>
  <span class='def def kw'>def</span> <span class='is_base? fid id'>is_base?</span>
    <span class='return return kw'>return</span> <span class='@is_base ivar id'>@is_base</span> <span class='if if_mod kw'>if</span> <span class='defined? defined kw'>defined?</span> <span class='@is_base ivar id'>@is_base</span>
    <span class='return return kw'>return</span> <span class='@is_base ivar id'>@is_base</span><span class='assign token'>=</span><span class='true true kw'>true</span> <span class='if if_mod kw'>if</span> <span class='@signature ivar id'>@signature</span> <span class='eq op'>==</span> <span class='integer val'>400</span> <span class='andop op'>&amp;&amp;</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='numerator identifier id'>numerator</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='eq op'>==</span> <span class='integer val'>1</span> <span class='andop op'>&amp;&amp;</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='denominator identifier id'>denominator</span> <span class='eq op'>==</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span> <span class='andop op'>&amp;&amp;</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='units identifier id'>units</span> <span class='match op'>=~</span> <span class='regexp val'>/(deg|temp)K/</span>
    <span class='n identifier id'>n</span> <span class='assign token'>=</span> <span class='@numerator ivar id'>@numerator</span> <span class='plus op'>+</span> <span class='@denominator ivar id'>@denominator</span>
    <span class='for for kw'>for</span> <span class='x identifier id'>x</span> <span class='in in kw'>in</span> <span class='n identifier id'>n</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span> <span class='do do kw'>do</span> 
      <span class='return return kw'>return</span> <span class='@is_base ivar id'>@is_base</span><span class='assign token'>=</span><span class='false false kw'>false</span> <span class='unless unless_mod kw'>unless</span> <span class='x identifier id'>x</span> <span class='eq op'>==</span> <span class='UNITY constant id'>UNITY</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='@@BASE_UNITS ivar id'>@@BASE_UNITS</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='return return kw'>return</span> <span class='@is_base ivar id'>@is_base</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='end end kw'>end</span>  
  
  <span class='comment val'># convert to base SI units</span>
  <span class='comment val'># results of the conversion are cached so subsequent calls to this will be fast</span>
  <span class='def def kw'>def</span> <span class='to_base identifier id'>to_base</span>
    <span class='return return kw'>return</span> <span class='self self kw'>self</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='is_base? fid id'>is_base?</span>
     <span class='if if kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='units identifier id'>units</span> <span class='match op'>=~</span> <span class='regexp val'>/\A(deg|temp)(C|F|K|C)\Z/</span>
      <span class='@signature ivar id'>@signature</span> <span class='assign token'>=</span> <span class='integer val'>400</span>
      <span class='base identifier id'>base</span> <span class='assign token'>=</span> <span class='case case kw'>case</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='units identifier id'>units</span>
      <span class='when when kw'>when</span> <span class='regexp val'>/temp/</span> <span class='colon op'>:</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='string val'>'tempK'</span><span class='rparen token'>)</span>
      <span class='when when kw'>when</span> <span class='regexp val'>/deg/</span> <span class='colon op'>:</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='string val'>'degK'</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
      <span class='return return kw'>return</span> <span class='base identifier id'>base</span>
    <span class='end end kw'>end</span>

    <span class='cached identifier id'>cached</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='@@base_unit_cache ivar id'>@@base_unit_cache</span><span class='lbrack token'>[</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='units identifier id'>units</span><span class='rbrack token'>]</span> <span class='mult op'>*</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span><span class='rparen token'>)</span> <span class='rescue rescue kw'>rescue</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='cached identifier id'>cached</span> <span class='if if_mod kw'>if</span> <span class='cached identifier id'>cached</span>
   
    <span class='num identifier id'>num</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='den identifier id'>den</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='q identifier id'>q</span> <span class='assign token'>=</span> <span class='integer val'>1</span>
    <span class='for for kw'>for</span> <span class='unit identifier id'>unit</span> <span class='in in kw'>in</span> <span class='@numerator ivar id'>@numerator</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span> <span class='do do kw'>do</span>
        <span class='if if kw'>if</span> <span class='@@PREFIX_VALUES ivar id'>@@PREFIX_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span>
          <span class='q identifier id'>q</span> <span class='opasgn op'>*=</span> <span class='@@PREFIX_VALUES ivar id'>@@PREFIX_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span>
        <span class='else else kw'>else</span>
          <span class='q identifier id'>q</span> <span class='opasgn op'>*=</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:scalar</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span>
          <span class='num identifier id'>num</span> <span class='lshft op'>&lt;&lt;</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:numerator</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:numerator</span><span class='rbrack token'>]</span>
          <span class='den identifier id'>den</span> <span class='lshft op'>&lt;&lt;</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:denominator</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:denominator</span><span class='rbrack token'>]</span>
        <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='for for kw'>for</span> <span class='unit identifier id'>unit</span> <span class='in in kw'>in</span> <span class='@denominator ivar id'>@denominator</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span> <span class='do do kw'>do</span>
        <span class='if if kw'>if</span> <span class='@@PREFIX_VALUES ivar id'>@@PREFIX_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span>
          <span class='q identifier id'>q</span> <span class='opasgn op'>/=</span> <span class='@@PREFIX_VALUES ivar id'>@@PREFIX_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span>
        <span class='else else kw'>else</span>
          <span class='q identifier id'>q</span> <span class='opasgn op'>/=</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:scalar</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span>
          <span class='den identifier id'>den</span> <span class='lshft op'>&lt;&lt;</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:numerator</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:numerator</span><span class='rbrack token'>]</span>
          <span class='num identifier id'>num</span> <span class='lshft op'>&lt;&lt;</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:denominator</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='unit identifier id'>unit</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:denominator</span><span class='rbrack token'>]</span>
        <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    
    <span class='num identifier id'>num</span> <span class='assign token'>=</span> <span class='num identifier id'>num</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span>
    <span class='den identifier id'>den</span> <span class='assign token'>=</span> <span class='den identifier id'>den</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span>
    <span class='num identifier id'>num</span> <span class='assign token'>=</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span> <span class='if if_mod kw'>if</span> <span class='num identifier id'>num</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='base identifier id'>base</span><span class='assign token'>=</span> <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='eliminate_terms identifier id'>eliminate_terms</span><span class='lparen token'>(</span><span class='q identifier id'>q</span><span class='comma token'>,</span><span class='num identifier id'>num</span><span class='comma token'>,</span><span class='den identifier id'>den</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='@@base_unit_cache ivar id'>@@base_unit_cache</span><span class='lbrack token'>[</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='units identifier id'>units</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='base identifier id'>base</span>
    <span class='return return kw'>return</span> <span class='base identifier id'>base</span> <span class='mult op'>*</span> <span class='@scalar ivar id'>@scalar</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># Generate human readable output.</span>
  <span class='comment val'># If the name of a unit is passed, the unit will first be converted to the target unit before output.</span>
  <span class='comment val'># some named conversions are available</span>
  <span class='comment val'>#</span>
  <span class='comment val'>#  :ft - outputs in feet and inches (e.g., 6'4&quot;)</span>
  <span class='comment val'>#  :lbs - outputs in pounds and ounces (e.g, 8 lbs, 8 oz)</span>
  <span class='comment val'>#  </span>
  <span class='comment val'># You can also pass a standard format string (i.e., '%0.2f')</span>
  <span class='comment val'># or a strftime format string.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># output is cached so subsequent calls for the same format will be fast</span>
  <span class='comment val'>#</span>
  <span class='def def kw'>def</span> <span class='to_s identifier id'>to_s</span><span class='lparen token'>(</span><span class='target_units identifier id'>target_units</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
    <span class='out identifier id'>out</span> <span class='assign token'>=</span> <span class='@output ivar id'>@output</span><span class='lbrack token'>[</span><span class='target_units identifier id'>target_units</span><span class='rbrack token'>]</span>
    <span class='if if kw'>if</span> <span class='out identifier id'>out</span>
      <span class='return return kw'>return</span> <span class='out identifier id'>out</span>
    <span class='else else kw'>else</span>
      <span class='case case kw'>case</span> <span class='target_units identifier id'>target_units</span>
      <span class='when when kw'>when</span> <span class='symbol val'>:ft</span> <span class='colon op'>:</span>
        <span class='inches identifier id'>inches</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='string val'>&quot;in&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span><span class='dot token'>.</span><span class='to_int identifier id'>to_int</span>
        <span class='out identifier id'>out</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{(inches / 12).truncate}\'#{(inches % 12).round}\&quot;&quot;</span>
      <span class='when when kw'>when</span> <span class='symbol val'>:lbs</span> <span class='colon op'>:</span>
        <span class='ounces identifier id'>ounces</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='string val'>&quot;oz&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span><span class='dot token'>.</span><span class='to_int identifier id'>to_int</span>
        <span class='out identifier id'>out</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{(ounces / 16).truncate} lbs, #{(ounces % 16).round} oz&quot;</span>
      <span class='when when kw'>when</span> <span class='String constant id'>String</span>
        <span class='out identifier id'>out</span> <span class='assign token'>=</span> <span class='case case kw'>case</span> <span class='target_units identifier id'>target_units</span>
        <span class='when when kw'>when</span> <span class='regexp val'>/(%[-+\.\w\d#]+)\s*(.+)*/</span>       <span class='comment val'>#format string like '%0.2f in'</span>
          <span class='begin begin kw'>begin</span>
            <span class='if if kw'>if</span> <span class='$2 nth_ref id'>$2</span> <span class='comment val'>#unit specified, need to convert</span>
              <span class='self self kw'>self</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='$2 nth_ref id'>$2</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='lparen token'>(</span><span class='$1 nth_ref id'>$1</span><span class='rparen token'>)</span>
            <span class='else else kw'>else</span> 
              <span class='dstring node'>&quot;#{$1 % @scalar} #{$2 || self.units}&quot;</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
            <span class='end end kw'>end</span>
          <span class='rescue rescue kw'>rescue</span>
            <span class='lparen token'>(</span><span class='DateTime constant id'>DateTime</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='self self kw'>self</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='strftime identifier id'>strftime</span><span class='lparen token'>(</span><span class='target_units identifier id'>target_units</span><span class='rparen token'>)</span>  
          <span class='end end kw'>end</span>
        <span class='when when kw'>when</span> <span class='regexp val'>/(\S+)/</span> <span class='comment val'>#unit only 'mm' or '1/mm'</span>
          <span class='dstring node'>&quot;#{self.to($1).to_s}&quot;</span>
        <span class='else else kw'>else</span>
          <span class='raise identifier id'>raise</span> <span class='string val'>&quot;unhandled case&quot;</span>
        <span class='end end kw'>end</span>
      <span class='else else kw'>else</span>
        <span class='out identifier id'>out</span> <span class='assign token'>=</span> <span class='case case kw'>case</span> <span class='@scalar ivar id'>@scalar</span>
        <span class='when when kw'>when</span> <span class='Rational constant id'>Rational</span> <span class='colon op'>:</span> 
          <span class='dstring node'>&quot;#{@scalar} #{self.units}&quot;</span>
        <span class='else else kw'>else</span>
          <span class='dstring node'>&quot;#{'%g' % @scalar} #{self.units}&quot;</span>
        <span class='end end kw'>end</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
      <span class='end end kw'>end</span>
      <span class='@output ivar id'>@output</span><span class='lbrack token'>[</span><span class='target_units identifier id'>target_units</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='out identifier id'>out</span>
      <span class='return return kw'>return</span> <span class='out identifier id'>out</span>
    <span class='end end kw'>end</span>    
  <span class='end end kw'>end</span>
  
  <span class='comment val'># Normally pretty prints the unit, but if you really want to see the guts of it, pass ':dump'</span>
  <span class='def def kw'>def</span> <span class='inspect identifier id'>inspect</span><span class='lparen token'>(</span><span class='option identifier id'>option</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='super super kw'>super</span><span class='lparen token'>(</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='option identifier id'>option</span> <span class='eq op'>==</span> <span class='symbol val'>:dump</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># true if unit is a 'temperature', false if a 'degree' or anything else</span>
  <span class='def def kw'>def</span> <span class='is_temperature? fid id'>is_temperature?</span>
    <span class='return return kw'>return</span> <span class='true true kw'>true</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='signature identifier id'>signature</span> <span class='eq op'>==</span> <span class='integer val'>400</span> <span class='andop op'>&amp;&amp;</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='units identifier id'>units</span> <span class='match op'>=~</span> <span class='regexp val'>/temp/</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># returns the 'degree' unit associated with a temperature unit</span>
  <span class='comment val'># '100 tempC'.unit.temperature_scale #=&gt; 'degC'</span>
  <span class='def def kw'>def</span> <span class='temperature_scale identifier id'>temperature_scale</span>
    <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='unless unless_mod kw'>unless</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='is_temperature? fid id'>is_temperature?</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='units identifier id'>units</span> <span class='match op'>=~</span> <span class='regexp val'>/temp(C|F|R|K)/</span>
    <span class='dstring node'>&quot;deg#{$1}&quot;</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># returns true if no associated units</span>
  <span class='comment val'># false, even if the units are &quot;unitless&quot; like 'radians, each, etc'</span>
  <span class='def def kw'>def</span> <span class='unitless? fid id'>unitless?</span>
    <span class='lparen token'>(</span><span class='@numerator ivar id'>@numerator</span> <span class='eq op'>==</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span> <span class='andop op'>&amp;&amp;</span> <span class='@denominator ivar id'>@denominator</span> <span class='eq op'>==</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># Compare two Unit objects. Throws an exception if they are not of compatible types.</span>
  <span class='comment val'># Comparisons are done based on the value of the unit in base SI units.</span>
  <span class='def def kw'>def</span> <span class='cmp op'>&lt;=&gt;</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
    <span class='case case kw'>case</span> <span class='other identifier id'>other</span>
    <span class='when when kw'>when</span> <span class='integer val'>0</span><span class='colon op'>:</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='base_scalar identifier id'>base_scalar</span> <span class='cmp op'>&lt;=&gt;</span> <span class='integer val'>0</span>
    <span class='when when kw'>when</span> <span class='Unit constant id'>Unit</span><span class='colon op'>:</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Incompatible Units&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='self self kw'>self</span> <span class='match op'>=~</span> <span class='other identifier id'>other</span>
      <span class='self self kw'>self</span><span class='dot token'>.</span><span class='base_scalar identifier id'>base_scalar</span> <span class='cmp op'>&lt;=&gt;</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='base_scalar identifier id'>base_scalar</span>
    <span class='else else kw'>else</span>
      <span class='x identifier id'>x</span><span class='comma token'>,</span><span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
      <span class='x identifier id'>x</span> <span class='cmp op'>&lt;=&gt;</span> <span class='y identifier id'>y</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># check to see if units are compatible, but not the scalar part</span>
  <span class='comment val'># this check is done by comparing signatures for performance reasons</span>
  <span class='comment val'># if passed a string, it will create a unit object with the string and then do the comparison</span>
  <span class='comment val'># this permits a syntax like:  </span>
  <span class='comment val'>#  unit =~ &quot;mm&quot;</span>
  <span class='comment val'># if you want to do a regexp on the unit string do this ...</span>
  <span class='comment val'>#  unit.units =~ /regexp/</span>
  <span class='def def kw'>def</span> <span class='match op'>=~</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='true true kw'>true</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span> <span class='eq op'>==</span> <span class='integer val'>0</span> <span class='orop op'>||</span> <span class='other identifier id'>other</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
    <span class='case case kw'>case</span> <span class='other identifier id'>other</span>
    <span class='when when kw'>when</span> <span class='Unit constant id'>Unit</span> <span class='colon op'>:</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='signature identifier id'>signature</span> <span class='eq op'>==</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='signature identifier id'>signature</span>
    <span class='else else kw'>else</span>
      <span class='x identifier id'>x</span><span class='comma token'>,</span><span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
      <span class='x identifier id'>x</span> <span class='match op'>=~</span> <span class='y identifier id'>y</span>
    <span class='end end kw'>end</span> 
  <span class='end end kw'>end</span>
  
  <span class='alias alias kw'>alias</span> <span class='symbol val'>:compatible?</span> <span class='symbol val'>:=~</span>
  <span class='alias alias kw'>alias</span> <span class='symbol val'>:compatible_with?</span> <span class='symbol val'>:=~</span>
  
  <span class='comment val'># Compare two units.  Returns true if quantities and units match</span>
  <span class='comment val'>#</span>
  <span class='comment val'># Unit(&quot;100 cm&quot;) === Unit(&quot;100 cm&quot;)   # =&gt; true</span>
  <span class='comment val'># Unit(&quot;100 cm&quot;) === Unit(&quot;1 m&quot;)      # =&gt; false</span>
  <span class='def def kw'>def</span> <span class='eqq op'>===</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
    <span class='case case kw'>case</span> <span class='other identifier id'>other</span>
    <span class='when when kw'>when</span> <span class='Unit constant id'>Unit</span><span class='colon op'>:</span> <span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span> <span class='eq op'>==</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='units identifier id'>units</span> <span class='eq op'>==</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='units identifier id'>units</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='x identifier id'>x</span><span class='comma token'>,</span><span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
      <span class='x identifier id'>x</span> <span class='eqq op'>===</span> <span class='y identifier id'>y</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  
  <span class='alias alias kw'>alias</span> <span class='symbol val'>:same?</span> <span class='symbol val'>:===</span>
  <span class='alias alias kw'>alias</span> <span class='symbol val'>:same_as?</span> <span class='symbol val'>:===</span>
  
  <span class='comment val'># Add two units together.  Result is same units as receiver and scalar and base_scalar are updated appropriately</span>
  <span class='comment val'># throws an exception if the units are not compatible.</span>
  <span class='comment val'># It is possible to add Time objects to units of time</span>
  <span class='def def kw'>def</span> <span class='plus op'>+</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>   
    <span class='if if kw'>if</span> <span class='Unit constant id'>Unit</span> <span class='eqq op'>===</span> <span class='other identifier id'>other</span> 
      <span class='case case kw'>case</span>
      <span class='when when kw'>when</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span> <span class='colon op'>:</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
      <span class='when when kw'>when</span> <span class='self self kw'>self</span> <span class='match op'>=~</span> <span class='other identifier id'>other</span> <span class='colon op'>:</span>
        <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Cannot add two temperatures&quot;</span> <span class='if if_mod kw'>if</span> <span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='other identifier id'>other</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='all? fid id'>all?</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='is_temperature? fid id'>is_temperature?</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
        <span class='if if kw'>if</span> <span class='lbrack token'>[</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='other identifier id'>other</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='any? fid id'>any?</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='is_temperature? fid id'>is_temperature?</span><span class='rbrace token'>}</span>
          <span class='case case kw'>case</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='is_temperature? fid id'>is_temperature?</span>
          <span class='when when kw'>when</span> <span class='true true kw'>true</span><span class='colon op'>:</span>
            <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:scalar</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span> <span class='plus op'>+</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='temperature_scale identifier id'>temperature_scale</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='symbol val'>:numerator</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@numerator ivar id'>@numerator</span><span class='comma token'>,</span> <span class='symbol val'>:denominator=</span><span class='gt op'>&gt;</span><span class='@denominator ivar id'>@denominator</span><span class='comma token'>,</span> <span class='symbol val'>:signature</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@signature ivar id'>@signature</span><span class='rparen token'>)</span>
          <span class='else else kw'>else</span>
            <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:scalar</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span> <span class='plus op'>+</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='temperature_scale identifier id'>temperature_scale</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='symbol val'>:numerator</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='numerator identifier id'>numerator</span><span class='comma token'>,</span> <span class='symbol val'>:denominator=</span><span class='gt op'>&gt;</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='denominator identifier id'>denominator</span><span class='comma token'>,</span> <span class='symbol val'>:signature</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='signature identifier id'>signature</span><span class='rparen token'>)</span>
          <span class='end end kw'>end</span>
        <span class='else else kw'>else</span>
          <span class='@q ivar id'>@q</span> <span class='opasgn op'>||=</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='@@cached_units ivar id'>@@cached_units</span><span class='lbrack token'>[</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='units identifier id'>units</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span> <span class='div op'>/</span> <span class='@@cached_units ivar id'>@@cached_units</span><span class='lbrack token'>[</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='units identifier id'>units</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='base_scalar identifier id'>base_scalar</span><span class='rparen token'>)</span> <span class='rescue rescue kw'>rescue</span> <span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='units identifier id'>units</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span><span class='dot token'>.</span><span class='to_base identifier id'>to_base</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
          <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:scalar=</span><span class='gt op'>&gt;</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='base_scalar identifier id'>base_scalar</span> <span class='plus op'>+</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='base_scalar identifier id'>base_scalar</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='@q ivar id'>@q</span><span class='comma token'>,</span> <span class='symbol val'>:numerator=</span><span class='gt op'>&gt;</span><span class='@numerator ivar id'>@numerator</span><span class='comma token'>,</span> <span class='symbol val'>:denominator=</span><span class='gt op'>&gt;</span><span class='@denominator ivar id'>@denominator</span><span class='comma token'>,</span> <span class='symbol val'>:signature</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@signature ivar id'>@signature</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='else else kw'>else</span>
         <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span>  <span class='dstring node'>&quot;Incompatible Units ('#{self}' not compatible with '#{other}')&quot;</span>
      <span class='end end kw'>end</span>
    <span class='elsif elsif kw'>elsif</span> <span class='Time constant id'>Time</span> <span class='eqq op'>===</span> <span class='other identifier id'>other</span>
      <span class='other identifier id'>other</span> <span class='plus op'>+</span> <span class='self self kw'>self</span>
    <span class='else else kw'>else</span>
        <span class='x identifier id'>x</span><span class='comma token'>,</span><span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
        <span class='y identifier id'>y</span> <span class='plus op'>+</span> <span class='x identifier id'>x</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># Subtract two units. Result is same units as receiver and scalar and base_scalar are updated appropriately</span>
  <span class='comment val'># throws an exception if the units are not compatible.</span>
  <span class='def def kw'>def</span> <span class='minus op'>-</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='Unit constant id'>Unit</span> <span class='eqq op'>===</span> <span class='other identifier id'>other</span> 
    <span class='case case kw'>case</span>
      <span class='when when kw'>when</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span> <span class='colon op'>:</span> <span class='minus op'>-</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
      <span class='when when kw'>when</span> <span class='self self kw'>self</span> <span class='match op'>=~</span> <span class='other identifier id'>other</span> <span class='colon op'>:</span>
        <span class='case case kw'>case</span>
          <span class='when when kw'>when</span> <span class='lbrack token'>[</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='other identifier id'>other</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='all? fid id'>all?</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='is_temperature? fid id'>is_temperature?</span><span class='rbrace token'>}</span> <span class='colon op'>:</span> 
            <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:scalar</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='base_scalar identifier id'>base_scalar</span> <span class='minus op'>-</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='base_scalar identifier id'>base_scalar</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='symbol val'>:numerator</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='KELVIN constant id'>KELVIN</span><span class='comma token'>,</span> <span class='symbol val'>:denominator</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span><span class='comma token'>,</span> <span class='symbol val'>:signature</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@signature ivar id'>@signature</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='temperature_scale identifier id'>temperature_scale</span><span class='rparen token'>)</span> 
          <span class='when when kw'>when</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='is_temperature? fid id'>is_temperature?</span> <span class='colon op'>:</span>
            <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:scalar</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='base_scalar identifier id'>base_scalar</span> <span class='minus op'>-</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='base_scalar identifier id'>base_scalar</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='symbol val'>:numerator</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='string val'>'&lt;temp-K&gt;'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:denominator</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span><span class='comma token'>,</span> <span class='symbol val'>:signature</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@signature ivar id'>@signature</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span> 
          <span class='when when kw'>when</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='is_temperature? fid id'>is_temperature?</span> <span class='colon op'>:</span>
            <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Cannot subtract a temperature from a differential degree unit&quot;</span>
          <span class='else else kw'>else</span>
            <span class='@q ivar id'>@q</span> <span class='opasgn op'>||=</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='@@cached_units ivar id'>@@cached_units</span><span class='lbrack token'>[</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='units identifier id'>units</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span> <span class='div op'>/</span> <span class='@@cached_units ivar id'>@@cached_units</span><span class='lbrack token'>[</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='units identifier id'>units</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='base_scalar identifier id'>base_scalar</span><span class='rparen token'>)</span> <span class='rescue rescue kw'>rescue</span> <span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='units identifier id'>units</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span><span class='div op'>/</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='units identifier id'>units</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span><span class='dot token'>.</span><span class='to_base identifier id'>to_base</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
            <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:scalar=</span><span class='gt op'>&gt;</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='base_scalar identifier id'>base_scalar</span> <span class='minus op'>-</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='base_scalar identifier id'>base_scalar</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='@q ivar id'>@q</span><span class='comma token'>,</span> <span class='symbol val'>:numerator=</span><span class='gt op'>&gt;</span><span class='@numerator ivar id'>@numerator</span><span class='comma token'>,</span> <span class='symbol val'>:denominator=</span><span class='gt op'>&gt;</span><span class='@denominator ivar id'>@denominator</span><span class='comma token'>,</span> <span class='symbol val'>:signature=</span><span class='gt op'>&gt;</span><span class='@signature ivar id'>@signature</span><span class='rparen token'>)</span>            
        <span class='end end kw'>end</span>
      <span class='else else kw'>else</span>
         <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span>  <span class='dstring node'>&quot;Incompatible Units ('#{self}' not compatible with '#{other}')&quot;</span>
      <span class='end end kw'>end</span>
    <span class='elsif elsif kw'>elsif</span> <span class='Time constant id'>Time</span> <span class='eqq op'>===</span> <span class='other identifier id'>other</span>
      <span class='other identifier id'>other</span> <span class='minus op'>-</span> <span class='self self kw'>self</span>
    <span class='else else kw'>else</span>
        <span class='x identifier id'>x</span><span class='comma token'>,</span><span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
        <span class='y identifier id'>y</span><span class='minus op'>-</span><span class='x identifier id'>x</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># Multiply two units.</span>
  <span class='def def kw'>def</span> <span class='mult op'>*</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
    <span class='case case kw'>case</span> <span class='other identifier id'>other</span>
    <span class='when when kw'>when</span> <span class='Unit constant id'>Unit</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Cannot multiply by temperatures&quot;</span> <span class='if if_mod kw'>if</span> <span class='lbrack token'>[</span><span class='other identifier id'>other</span><span class='comma token'>,</span><span class='self self kw'>self</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='any? fid id'>any?</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='is_temperature? fid id'>is_temperature?</span><span class='rbrace token'>}</span>
      <span class='opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='eliminate_terms identifier id'>eliminate_terms</span><span class='lparen token'>(</span><span class='@scalar ivar id'>@scalar</span><span class='mult op'>*</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span><span class='comma token'>,</span> <span class='@numerator ivar id'>@numerator</span> <span class='plus op'>+</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='numerator identifier id'>numerator</span> <span class='comma token'>,</span><span class='@denominator ivar id'>@denominator</span> <span class='plus op'>+</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='denominator identifier id'>denominator</span><span class='rparen token'>)</span>
      <span class='opts identifier id'>opts</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='symbol val'>:signature</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@signature ivar id'>@signature</span> <span class='plus op'>+</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='signature identifier id'>signature</span><span class='rparen token'>)</span>
      <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span><span class='rparen token'>)</span>      
    <span class='when when kw'>when</span> <span class='Numeric constant id'>Numeric</span>
      <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:scalar=</span><span class='gt op'>&gt;</span><span class='@scalar ivar id'>@scalar</span><span class='mult op'>*</span><span class='other identifier id'>other</span><span class='comma token'>,</span> <span class='symbol val'>:numerator=</span><span class='gt op'>&gt;</span><span class='@numerator ivar id'>@numerator</span><span class='comma token'>,</span> <span class='symbol val'>:denominator=</span><span class='gt op'>&gt;</span><span class='@denominator ivar id'>@denominator</span><span class='comma token'>,</span> <span class='symbol val'>:signature</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@signature ivar id'>@signature</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='x identifier id'>x</span><span class='comma token'>,</span><span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
      <span class='x identifier id'>x</span> <span class='mult op'>*</span> <span class='y identifier id'>y</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># Divide two units.</span>
  <span class='comment val'># Throws an exception if divisor is 0</span>
  <span class='def def kw'>def</span> <span class='div op'>/</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
    <span class='case case kw'>case</span> <span class='other identifier id'>other</span>
    <span class='when when kw'>when</span> <span class='Unit constant id'>Unit</span> 
      <span class='raise identifier id'>raise</span> <span class='ZeroDivisionError constant id'>ZeroDivisionError</span> <span class='if if_mod kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Cannot divide with temperatures&quot;</span> <span class='if if_mod kw'>if</span> <span class='lbrack token'>[</span><span class='other identifier id'>other</span><span class='comma token'>,</span><span class='self self kw'>self</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='any? fid id'>any?</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='is_temperature? fid id'>is_temperature?</span><span class='rbrace token'>}</span>
      <span class='opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='eliminate_terms identifier id'>eliminate_terms</span><span class='lparen token'>(</span><span class='@scalar ivar id'>@scalar</span><span class='div op'>/</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span><span class='comma token'>,</span> <span class='@numerator ivar id'>@numerator</span> <span class='plus op'>+</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='denominator identifier id'>denominator</span> <span class='comma token'>,</span><span class='@denominator ivar id'>@denominator</span> <span class='plus op'>+</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='numerator identifier id'>numerator</span><span class='rparen token'>)</span>
      <span class='opts identifier id'>opts</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='symbol val'>:signature=</span><span class='gt op'>&gt;</span> <span class='@signature ivar id'>@signature</span> <span class='minus op'>-</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='signature identifier id'>signature</span><span class='rparen token'>)</span>
      <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span><span class='rparen token'>)</span>      
    <span class='when when kw'>when</span> <span class='Numeric constant id'>Numeric</span>
      <span class='raise identifier id'>raise</span> <span class='ZeroDivisionError constant id'>ZeroDivisionError</span> <span class='if if_mod kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span>
      <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:scalar=</span><span class='gt op'>&gt;</span><span class='@scalar ivar id'>@scalar</span><span class='div op'>/</span><span class='other identifier id'>other</span><span class='comma token'>,</span> <span class='symbol val'>:numerator=</span><span class='gt op'>&gt;</span><span class='@numerator ivar id'>@numerator</span><span class='comma token'>,</span> <span class='symbol val'>:denominator=</span><span class='gt op'>&gt;</span><span class='@denominator ivar id'>@denominator</span><span class='comma token'>,</span> <span class='symbol val'>:signature</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@signature ivar id'>@signature</span><span class='rparen token'>)</span>      
    <span class='else else kw'>else</span>
      <span class='x identifier id'>x</span><span class='comma token'>,</span><span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
      <span class='y identifier id'>y</span> <span class='div op'>/</span> <span class='x identifier id'>x</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
    
  <span class='comment val'># Exponentiate.  Only takes integer powers. </span>
  <span class='comment val'># Note that anything raised to the power of 0 results in a Unit object with a scalar of 1, and no units.</span>
  <span class='comment val'># Throws an exception if exponent is not an integer.</span>
  <span class='comment val'># Ideally this routine should accept a float for the exponent</span>
  <span class='comment val'># It should then convert the float to a rational and raise the unit by the numerator and root it by the denominator</span>
  <span class='comment val'># but, sadly, floats can't be converted to rationals.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># For now, if a rational is passed in, it will be used, otherwise we are stuck with integers and certain floats &lt; 1</span>
  <span class='def def kw'>def</span> <span class='pow op'>**</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Cannot raise a temperature to a power&quot;</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='is_temperature? fid id'>is_temperature?</span>
    <span class='if if kw'>if</span> <span class='Numeric constant id'>Numeric</span> <span class='eqq op'>===</span> <span class='other identifier id'>other</span>
      <span class='return return kw'>return</span> <span class='Unit constant id'>Unit</span><span class='lparen token'>(</span><span class='string val'>&quot;1&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span>
      <span class='return return kw'>return</span> <span class='self self kw'>self</span> <span class='if if_mod kw'>if</span> <span class='other identifier id'>other</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
      <span class='return return kw'>return</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='inverse identifier id'>inverse</span> <span class='if if_mod kw'>if</span> <span class='other identifier id'>other</span> <span class='eq op'>==</span> <span class='integer val'>-1</span>
    <span class='end end kw'>end</span>
    <span class='case case kw'>case</span> <span class='other identifier id'>other</span>
    <span class='when when kw'>when</span> <span class='Rational constant id'>Rational</span><span class='colon op'>:</span>
      <span class='self self kw'>self</span><span class='dot token'>.</span><span class='power identifier id'>power</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='numerator identifier id'>numerator</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='root identifier id'>root</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='denominator identifier id'>denominator</span><span class='rparen token'>)</span>
    <span class='when when kw'>when</span> <span class='Integer constant id'>Integer</span><span class='colon op'>:</span>
      <span class='self self kw'>self</span><span class='dot token'>.</span><span class='power identifier id'>power</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
    <span class='when when kw'>when</span> <span class='Float constant id'>Float</span><span class='colon op'>:</span>
      <span class='return return kw'>return</span> <span class='self self kw'>self</span><span class='pow op'>**</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='other identifier id'>other</span> <span class='eq op'>==</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
      <span class='valid identifier id'>valid</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='integer val'>9</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='integer val'>1</span><span class='div op'>/</span><span class='x identifier id'>x</span><span class='rbrace token'>}</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Not a n-th root (1..9), use 1/n&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='valid identifier id'>valid</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span>
      <span class='self self kw'>self</span><span class='dot token'>.</span><span class='root identifier id'>root</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='div op'>/</span><span class='other identifier id'>other</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_int identifier id'>to_int</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Invalid Exponent&quot;</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># returns the unit raised to the n-th power.  Integers only</span>
  <span class='def def kw'>def</span> <span class='power identifier id'>power</span><span class='lparen token'>(</span><span class='n identifier id'>n</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Cannot raise a temperature to a power&quot;</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='is_temperature? fid id'>is_temperature?</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Can only use Integer exponenents&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='Integer constant id'>Integer</span> <span class='eqq op'>===</span> <span class='n identifier id'>n</span>
    <span class='return return kw'>return</span> <span class='self self kw'>self</span> <span class='if if_mod kw'>if</span> <span class='n identifier id'>n</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
    <span class='return return kw'>return</span> <span class='Unit constant id'>Unit</span><span class='lparen token'>(</span><span class='string val'>&quot;1&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='n identifier id'>n</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
    <span class='return return kw'>return</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='inverse identifier id'>inverse</span> <span class='if if_mod kw'>if</span> <span class='n identifier id'>n</span> <span class='eq op'>==</span> <span class='integer val'>-1</span>
    <span class='if if kw'>if</span> <span class='n identifier id'>n</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span> <span class='then then kw'>then</span> 
      <span class='lparen token'>(</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='lparen token'>(</span><span class='n identifier id'>n</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='product identifier id'>product</span><span class='comma token'>,</span> <span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='product identifier id'>product</span> <span class='mult op'>*</span> <span class='self self kw'>self</span><span class='rbrace token'>}</span>
    <span class='else else kw'>else</span>
      <span class='lparen token'>(</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='minus op'>-</span><span class='lparen token'>(</span><span class='n identifier id'>n</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='product identifier id'>product</span><span class='comma token'>,</span> <span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='product identifier id'>product</span> <span class='div op'>/</span> <span class='self self kw'>self</span><span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># Calculates the n-th root of a unit, where n = (1..9)</span>
  <span class='comment val'># if n &lt; 0, returns 1/unit^(1/n)</span>
  <span class='def def kw'>def</span> <span class='root identifier id'>root</span><span class='lparen token'>(</span><span class='n identifier id'>n</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Cannot take the root of a temperature&quot;</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='is_temperature? fid id'>is_temperature?</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Exponent must an Integer&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='Integer constant id'>Integer</span> <span class='eqq op'>===</span> <span class='n identifier id'>n</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;0th root undefined&quot;</span> <span class='if if_mod kw'>if</span> <span class='n identifier id'>n</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
    <span class='return return kw'>return</span> <span class='self self kw'>self</span> <span class='if if_mod kw'>if</span> <span class='n identifier id'>n</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
    <span class='return return kw'>return</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='root identifier id'>root</span><span class='lparen token'>(</span><span class='n identifier id'>n</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='inverse identifier id'>inverse</span> <span class='if if_mod kw'>if</span> <span class='n identifier id'>n</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span>
    
    <span class='vec identifier id'>vec</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='unit_signature_vector identifier id'>unit_signature_vector</span>
    <span class='vec identifier id'>vec</span><span class='assign token'>=</span><span class='vec identifier id'>vec</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span> <span class='mod op'>%</span> <span class='n identifier id'>n</span><span class='rbrace token'>}</span>      
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Illegal root&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='vec identifier id'>vec</span><span class='dot token'>.</span><span class='max identifier id'>max</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
    <span class='num identifier id'>num</span> <span class='assign token'>=</span> <span class='@numerator ivar id'>@numerator</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
    <span class='den identifier id'>den</span> <span class='assign token'>=</span> <span class='@denominator ivar id'>@denominator</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
      
    <span class='for for kw'>for</span> <span class='item identifier id'>item</span> <span class='in in kw'>in</span> <span class='@numerator ivar id'>@numerator</span><span class='dot token'>.</span><span class='uniq identifier id'>uniq</span> <span class='do do kw'>do</span>
      <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='num identifier id'>num</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span> <span class='i identifier id'>i</span><span class='eq op'>==</span><span class='item identifier id'>item</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
      <span class='r identifier id'>r</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='div op'>/</span><span class='n identifier id'>n</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='lparen token'>(</span><span class='n identifier id'>n</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_int identifier id'>to_int</span>
      <span class='r identifier id'>r</span><span class='dot token'>.</span><span class='times identifier id'>times</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='num identifier id'>num</span><span class='dot token'>.</span><span class='delete_at identifier id'>delete_at</span><span class='lparen token'>(</span><span class='num identifier id'>num</span><span class='dot token'>.</span><span class='index identifier id'>index</span><span class='lparen token'>(</span><span class='item identifier id'>item</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
    
    <span class='for for kw'>for</span> <span class='item identifier id'>item</span> <span class='in in kw'>in</span> <span class='@denominator ivar id'>@denominator</span><span class='dot token'>.</span><span class='uniq identifier id'>uniq</span> <span class='do do kw'>do</span> 
      <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='den identifier id'>den</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span> <span class='i identifier id'>i</span><span class='eq op'>==</span><span class='item identifier id'>item</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
      <span class='r identifier id'>r</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='div op'>/</span><span class='n identifier id'>n</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='lparen token'>(</span><span class='n identifier id'>n</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_int identifier id'>to_int</span>
      <span class='r identifier id'>r</span><span class='dot token'>.</span><span class='times identifier id'>times</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='den identifier id'>den</span><span class='dot token'>.</span><span class='delete_at identifier id'>delete_at</span><span class='lparen token'>(</span><span class='den identifier id'>den</span><span class='dot token'>.</span><span class='index identifier id'>index</span><span class='lparen token'>(</span><span class='item identifier id'>item</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
    <span class='q identifier id'>q</span> <span class='assign token'>=</span> <span class='@scalar ivar id'>@scalar</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span> <span class='question op'>?</span> <span class='lparen token'>(</span><span class='integer val'>-1</span><span class='rparen token'>)</span><span class='pow op'>**</span><span class='Rational constant id'>Rational</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='comma token'>,</span><span class='n identifier id'>n</span><span class='rparen token'>)</span> <span class='mult op'>*</span> <span class='lparen token'>(</span><span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span><span class='rparen token'>)</span><span class='pow op'>**</span><span class='Rational constant id'>Rational</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='comma token'>,</span><span class='n identifier id'>n</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='@scalar ivar id'>@scalar</span><span class='pow op'>**</span><span class='Rational constant id'>Rational</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='comma token'>,</span><span class='n identifier id'>n</span><span class='rparen token'>)</span>
    <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:scalar=</span><span class='gt op'>&gt;</span><span class='q identifier id'>q</span><span class='comma token'>,</span><span class='symbol val'>:numerator=</span><span class='gt op'>&gt;</span><span class='num identifier id'>num</span><span class='comma token'>,</span><span class='symbol val'>:denominator=</span><span class='gt op'>&gt;</span><span class='den identifier id'>den</span><span class='rparen token'>)</span>    
  <span class='end end kw'>end</span>
  
  <span class='comment val'># returns inverse of Unit (1/unit)</span>
  <span class='def def kw'>def</span> <span class='inverse identifier id'>inverse</span>
    <span class='Unit constant id'>Unit</span><span class='lparen token'>(</span><span class='string val'>&quot;1&quot;</span><span class='rparen token'>)</span> <span class='div op'>/</span> <span class='self self kw'>self</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># convert to a specified unit string or to the same units as another Unit</span>
  <span class='comment val'># </span>
  <span class='comment val'>#  unit &gt;&gt; &quot;kg&quot;  will covert to kilograms</span>
  <span class='comment val'>#  unit1 &gt;&gt; unit2 converts to same units as unit2 object</span>
  <span class='comment val'># </span>
  <span class='comment val'># To convert a Unit object to match another Unit object, use:</span>
  <span class='comment val'>#  unit1 &gt;&gt;= unit2</span>
  <span class='comment val'># Throws an exception if the requested target units are incompatible with current Unit.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># Special handling for temperature conversions is supported.  If the Unit object is converted</span>
  <span class='comment val'># from one temperature unit to another, the proper temperature offsets will be used.</span>
  <span class='comment val'># Supports Kelvin, Celcius, fahrenheit, and Rankine scales.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># Note that if temperature is part of a compound unit, the temperature will be treated as a differential</span>
  <span class='comment val'># and the units will be scaled appropriately.</span>
  <span class='def def kw'>def</span> <span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='self self kw'>self</span> <span class='if if_mod kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> 
    <span class='return return kw'>return</span> <span class='self self kw'>self</span> <span class='if if_mod kw'>if</span> <span class='TrueClass constant id'>TrueClass</span> <span class='eqq op'>===</span> <span class='other identifier id'>other</span>
    <span class='return return kw'>return</span> <span class='self self kw'>self</span> <span class='if if_mod kw'>if</span> <span class='FalseClass constant id'>FalseClass</span> <span class='eqq op'>===</span> <span class='other identifier id'>other</span>
    <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='Unit constant id'>Unit</span> <span class='eqq op'>===</span> <span class='other identifier id'>other</span> <span class='andop op'>&amp;&amp;</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='is_temperature? fid id'>is_temperature?</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='String constant id'>String</span> <span class='eqq op'>===</span> <span class='other identifier id'>other</span> <span class='andop op'>&amp;&amp;</span> <span class='other identifier id'>other</span> <span class='match op'>=~</span> <span class='regexp val'>/temp(K|C|R|F)/</span><span class='rparen token'>)</span> 
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Receiver is not a temperature unit&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='signature identifier id'>signature</span> <span class='eq op'>==</span> <span class='integer val'>400</span> 
      <span class='start_unit identifier id'>start_unit</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='units identifier id'>units</span>
      <span class='target_unit identifier id'>target_unit</span> <span class='assign token'>=</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='units identifier id'>units</span> <span class='rescue rescue kw'>rescue</span> <span class='other identifier id'>other</span>
      <span class='unless unless kw'>unless</span> <span class='@base_scalar ivar id'>@base_scalar</span>
        <span class='@base_scalar ivar id'>@base_scalar</span> <span class='assign token'>=</span> <span class='case case kw'>case</span> <span class='start_unit identifier id'>start_unit</span>
          <span class='when when kw'>when</span> <span class='string val'>'tempC'</span> <span class='colon op'>:</span> <span class='@scalar ivar id'>@scalar</span> <span class='plus op'>+</span> <span class='float val'>273.15</span>
          <span class='when when kw'>when</span> <span class='string val'>'tempK'</span> <span class='colon op'>:</span> <span class='@scalar ivar id'>@scalar</span>
          <span class='when when kw'>when</span> <span class='string val'>'tempF'</span> <span class='colon op'>:</span> <span class='lparen token'>(</span><span class='@scalar ivar id'>@scalar</span><span class='plus op'>+</span><span class='float val'>459.67</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='lparen token'>(</span><span class='float val'>5.0</span><span class='div op'>/</span><span class='float val'>9.0</span><span class='rparen token'>)</span>
          <span class='when when kw'>when</span> <span class='string val'>'tempR'</span> <span class='colon op'>:</span> <span class='@scalar ivar id'>@scalar</span><span class='mult op'>*</span><span class='lparen token'>(</span><span class='float val'>5.0</span><span class='div op'>/</span><span class='float val'>9.0</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
      <span class='q identifier id'>q</span><span class='assign token'>=</span>  <span class='case case kw'>case</span> <span class='target_unit identifier id'>target_unit</span>
            <span class='when when kw'>when</span> <span class='string val'>'tempC'</span>  <span class='colon op'>:</span> <span class='@base_scalar ivar id'>@base_scalar</span> <span class='minus op'>-</span> <span class='float val'>273.15</span>
            <span class='when when kw'>when</span> <span class='string val'>'tempK'</span>  <span class='colon op'>:</span> <span class='@base_scalar ivar id'>@base_scalar</span> 
            <span class='when when kw'>when</span> <span class='string val'>'tempF'</span>  <span class='colon op'>:</span> <span class='@base_scalar ivar id'>@base_scalar</span> <span class='mult op'>*</span> <span class='lparen token'>(</span><span class='float val'>9.0</span><span class='div op'>/</span><span class='float val'>5.0</span><span class='rparen token'>)</span> <span class='minus op'>-</span> <span class='float val'>459.67</span>
            <span class='when when kw'>when</span> <span class='string val'>'tempR'</span>  <span class='colon op'>:</span> <span class='@base_scalar ivar id'>@base_scalar</span> <span class='mult op'>*</span> <span class='lparen token'>(</span><span class='float val'>9.0</span><span class='div op'>/</span><span class='float val'>5.0</span><span class='rparen token'>)</span> 
          <span class='end end kw'>end</span>
        
      <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{q} #{target_unit}&quot;</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
       <span class='case case kw'>case</span> <span class='other identifier id'>other</span>
          <span class='when when kw'>when</span> <span class='Unit constant id'>Unit</span><span class='colon op'>:</span> 
            <span class='return return kw'>return</span> <span class='self self kw'>self</span> <span class='if if_mod kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='units identifier id'>units</span> <span class='eq op'>==</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='units identifier id'>units</span>
            <span class='target identifier id'>target</span> <span class='assign token'>=</span> <span class='other identifier id'>other</span>
          <span class='when when kw'>when</span> <span class='String constant id'>String</span><span class='colon op'>:</span> <span class='target identifier id'>target</span> <span class='assign token'>=</span> <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
          <span class='else else kw'>else</span>
            <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Unknown target units&quot;</span>
        <span class='end end kw'>end</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span>  <span class='string val'>&quot;Incompatible Units&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='self self kw'>self</span> <span class='match op'>=~</span> <span class='target identifier id'>target</span>
      <span class='one identifier id'>one</span> <span class='assign token'>=</span> <span class='@numerator ivar id'>@numerator</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='@@PREFIX_VALUES ivar id'>@@PREFIX_VALUES</span><span class='lbrack token'>[</span><span class='x identifier id'>x</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='@@PREFIX_VALUES ivar id'>@@PREFIX_VALUES</span><span class='lbrack token'>[</span><span class='x identifier id'>x</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='x identifier id'>x</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span> <span class='i identifier id'>i</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Numeric constant id'>Numeric</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='i identifier id'>i</span> <span class='colon op'>:</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:scalar</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span>
      <span class='two identifier id'>two</span> <span class='assign token'>=</span> <span class='@denominator ivar id'>@denominator</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='@@PREFIX_VALUES ivar id'>@@PREFIX_VALUES</span><span class='lbrack token'>[</span><span class='x identifier id'>x</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='@@PREFIX_VALUES ivar id'>@@PREFIX_VALUES</span><span class='lbrack token'>[</span><span class='x identifier id'>x</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='x identifier id'>x</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span> <span class='i identifier id'>i</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Numeric constant id'>Numeric</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='i identifier id'>i</span> <span class='colon op'>:</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:scalar</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span>
      <span class='v identifier id'>v</span> <span class='assign token'>=</span> <span class='one identifier id'>one</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='product identifier id'>product</span><span class='comma token'>,</span><span class='n identifier id'>n</span><span class='bitor op'>|</span> <span class='product identifier id'>product</span><span class='mult op'>*</span><span class='n identifier id'>n</span><span class='rbrace token'>}</span> <span class='div op'>/</span> <span class='two identifier id'>two</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='product identifier id'>product</span><span class='comma token'>,</span><span class='n identifier id'>n</span><span class='bitor op'>|</span> <span class='product identifier id'>product</span><span class='mult op'>*</span><span class='n identifier id'>n</span><span class='rbrace token'>}</span>
      <span class='one identifier id'>one</span> <span class='assign token'>=</span> <span class='target identifier id'>target</span><span class='dot token'>.</span><span class='numerator identifier id'>numerator</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='@@PREFIX_VALUES ivar id'>@@PREFIX_VALUES</span><span class='lbrack token'>[</span><span class='x identifier id'>x</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='@@PREFIX_VALUES ivar id'>@@PREFIX_VALUES</span><span class='lbrack token'>[</span><span class='x identifier id'>x</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='x identifier id'>x</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Numeric constant id'>Numeric</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='x identifier id'>x</span> <span class='colon op'>:</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='x identifier id'>x</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:scalar</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span>
      <span class='two identifier id'>two</span> <span class='assign token'>=</span> <span class='target identifier id'>target</span><span class='dot token'>.</span><span class='denominator identifier id'>denominator</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='@@PREFIX_VALUES ivar id'>@@PREFIX_VALUES</span><span class='lbrack token'>[</span><span class='x identifier id'>x</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='@@PREFIX_VALUES ivar id'>@@PREFIX_VALUES</span><span class='lbrack token'>[</span><span class='x identifier id'>x</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='x identifier id'>x</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Numeric constant id'>Numeric</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='x identifier id'>x</span> <span class='colon op'>:</span> <span class='@@UNIT_VALUES ivar id'>@@UNIT_VALUES</span><span class='lbrack token'>[</span><span class='x identifier id'>x</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:scalar</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span>
      <span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='one identifier id'>one</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='product identifier id'>product</span><span class='comma token'>,</span><span class='n identifier id'>n</span><span class='bitor op'>|</span> <span class='product identifier id'>product</span><span class='mult op'>*</span><span class='n identifier id'>n</span><span class='rbrace token'>}</span> <span class='div op'>/</span> <span class='two identifier id'>two</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='product identifier id'>product</span><span class='comma token'>,</span><span class='n identifier id'>n</span><span class='bitor op'>|</span> <span class='product identifier id'>product</span><span class='mult op'>*</span><span class='n identifier id'>n</span><span class='rbrace token'>}</span>
      <span class='q identifier id'>q</span> <span class='assign token'>=</span> <span class='@scalar ivar id'>@scalar</span> <span class='mult op'>*</span> <span class='v identifier id'>v</span><span class='div op'>/</span><span class='y identifier id'>y</span>
      <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:scalar=</span><span class='gt op'>&gt;</span><span class='q identifier id'>q</span><span class='comma token'>,</span> <span class='symbol val'>:numerator=</span><span class='gt op'>&gt;</span><span class='target identifier id'>target</span><span class='dot token'>.</span><span class='numerator identifier id'>numerator</span><span class='comma token'>,</span> <span class='symbol val'>:denominator=</span><span class='gt op'>&gt;</span><span class='target identifier id'>target</span><span class='dot token'>.</span><span class='denominator identifier id'>denominator</span><span class='comma token'>,</span> <span class='symbol val'>:signature</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='target identifier id'>target</span><span class='dot token'>.</span><span class='signature identifier id'>signature</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>  
  <span class='alias alias kw'>alias</span> <span class='symbol val'>:&gt;&gt;</span> <span class='symbol val'>:to</span>
  <span class='alias alias kw'>alias</span> <span class='symbol val'>:convert_to</span> <span class='symbol val'>:to</span>
    
  <span class='comment val'># converts the unit back to a float if it is unitless.  Otherwise raises an exception</span>
  <span class='def def kw'>def</span> <span class='to_f identifier id'>to_f</span>
    <span class='return return kw'>return</span> <span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='unitless? fid id'>unitless?</span>
    <span class='raise identifier id'>raise</span> <span class='RuntimeError constant id'>RuntimeError</span><span class='comma token'>,</span> <span class='string val'>&quot;Can't convert to Float unless unitless.  Use Unit#scalar&quot;</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># converts the unit back to a complex if it is unitless.  Otherwise raises an exception</span>
  
  <span class='def def kw'>def</span> <span class='to_c identifier id'>to_c</span>
    <span class='return return kw'>return</span> <span class='Complex constant id'>Complex</span><span class='lparen token'>(</span><span class='@scalar ivar id'>@scalar</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='unitless? fid id'>unitless?</span>
    <span class='raise identifier id'>raise</span> <span class='RuntimeError constant id'>RuntimeError</span><span class='comma token'>,</span> <span class='string val'>&quot;Can't convert to Complex unless unitless.  Use Unit#scalar&quot;</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># returns the 'unit' part of the Unit object without the scalar</span>
  <span class='def def kw'>def</span> <span class='units identifier id'>units</span>
    <span class='return return kw'>return</span> <span class='string val'>&quot;&quot;</span> <span class='if if_mod kw'>if</span> <span class='@numerator ivar id'>@numerator</span> <span class='eq op'>==</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span> <span class='andop op'>&amp;&amp;</span> <span class='@denominator ivar id'>@denominator</span> <span class='eq op'>==</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span>
    <span class='return return kw'>return</span> <span class='@unit_name ivar id'>@unit_name</span> <span class='unless unless_mod kw'>unless</span> <span class='@unit_name ivar id'>@unit_name</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='output_n identifier id'>output_n</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='output_d identifier id'>output_d</span> <span class='assign token'>=</span><span class='lbrack token'>[</span><span class='rbrack token'>]</span> 
    <span class='num identifier id'>num</span> <span class='assign token'>=</span> <span class='@numerator ivar id'>@numerator</span><span class='dot token'>.</span><span class='clone identifier id'>clone</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span>
    <span class='den identifier id'>den</span> <span class='assign token'>=</span> <span class='@denominator ivar id'>@denominator</span><span class='dot token'>.</span><span class='clone identifier id'>clone</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span>
    <span class='if if kw'>if</span> <span class='@numerator ivar id'>@numerator</span> <span class='eq op'>==</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span>
      <span class='output_n identifier id'>output_n</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;1&quot;</span>
    <span class='else else kw'>else</span>
      <span class='num identifier id'>num</span><span class='dot token'>.</span><span class='each_with_index identifier id'>each_with_index</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='token identifier id'>token</span><span class='comma token'>,</span><span class='index identifier id'>index</span><span class='bitor op'>|</span>
        <span class='if if kw'>if</span> <span class='token identifier id'>token</span> <span class='andop op'>&amp;&amp;</span> <span class='@@PREFIX_VALUES ivar id'>@@PREFIX_VALUES</span><span class='lbrack token'>[</span><span class='token identifier id'>token</span><span class='rbrack token'>]</span> <span class='then then kw'>then</span>
          <span class='output_n identifier id'>output_n</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{@@OUTPUT_MAP[token]}#{@@OUTPUT_MAP[num[index+1]]}&quot;</span>
          <span class='num identifier id'>num</span><span class='lbrack token'>[</span><span class='index identifier id'>index</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span>
        <span class='else else kw'>else</span>
          <span class='output_n identifier id'>output_n</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{@@OUTPUT_MAP[token]}&quot;</span> <span class='if if_mod kw'>if</span> <span class='token identifier id'>token</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='if if kw'>if</span> <span class='@denominator ivar id'>@denominator</span> <span class='eq op'>==</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span>
      <span class='output_d identifier id'>output_d</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='string val'>'1'</span><span class='rbrack token'>]</span>
    <span class='else else kw'>else</span>
      <span class='den identifier id'>den</span><span class='dot token'>.</span><span class='each_with_index identifier id'>each_with_index</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='token identifier id'>token</span><span class='comma token'>,</span><span class='index identifier id'>index</span><span class='bitor op'>|</span>
          <span class='if if kw'>if</span> <span class='token identifier id'>token</span> <span class='andop op'>&amp;&amp;</span> <span class='@@PREFIX_VALUES ivar id'>@@PREFIX_VALUES</span><span class='lbrack token'>[</span><span class='token identifier id'>token</span><span class='rbrack token'>]</span> <span class='then then kw'>then</span>
            <span class='output_d identifier id'>output_d</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{@@OUTPUT_MAP[token]}#{@@OUTPUT_MAP[den[index+1]]}&quot;</span>
            <span class='den identifier id'>den</span><span class='lbrack token'>[</span><span class='index identifier id'>index</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span>
          <span class='else else kw'>else</span>
            <span class='output_d identifier id'>output_d</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{@@OUTPUT_MAP[token]}&quot;</span> <span class='if if_mod kw'>if</span> <span class='token identifier id'>token</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='on identifier id'>on</span> <span class='assign token'>=</span> <span class='output_n identifier id'>output_n</span><span class='dot token'>.</span><span class='reject identifier id'>reject</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='lbrack token'>[</span><span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='output_n identifier id'>output_n</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='z identifier id'>z</span><span class='bitor op'>|</span> <span class='z identifier id'>z</span><span class='eq op'>==</span><span class='x identifier id'>x</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='uniq identifier id'>uniq</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='dstring node'>&quot;#{x[0]}&quot;</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span><span class='plus op'>+</span> <span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span> <span class='question op'>?</span> <span class='dstring node'>&quot;^#{x[1]}&quot;</span> <span class='colon op'>:</span> <span class='string val'>''</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
    <span class='od identifier id'>od</span> <span class='assign token'>=</span> <span class='output_d identifier id'>output_d</span><span class='dot token'>.</span><span class='reject identifier id'>reject</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='lbrack token'>[</span><span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='output_d identifier id'>output_d</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='z identifier id'>z</span><span class='bitor op'>|</span> <span class='z identifier id'>z</span><span class='eq op'>==</span><span class='x identifier id'>x</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='uniq identifier id'>uniq</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='dstring node'>&quot;#{x[0]}&quot;</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span><span class='plus op'>+</span> <span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span> <span class='question op'>?</span> <span class='dstring node'>&quot;^#{x[1]}&quot;</span> <span class='colon op'>:</span> <span class='string val'>''</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
    <span class='out identifier id'>out</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{on.join('*')}#{od == ['1'] ? '': '/'+od.join('*')}&quot;</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>    
    <span class='@unit_name ivar id'>@unit_name</span> <span class='assign token'>=</span> <span class='out identifier id'>out</span> <span class='unless unless_mod kw'>unless</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='kind identifier id'>kind</span> <span class='eq op'>==</span> <span class='symbol val'>:temperature</span>
    <span class='return return kw'>return</span> <span class='out identifier id'>out</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># negates the scalar of the Unit</span>
  <span class='def def kw'>def</span> <span class='uminus op'>-@</span>
    <span class='return return kw'>return</span> <span class='minus op'>-</span><span class='@scalar ivar id'>@scalar</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='unitless? fid id'>unitless?</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span> <span class='mult op'>*</span> <span class='integer val'>-1</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># returns abs of scalar, without the units</span>
  <span class='def def kw'>def</span> <span class='abs identifier id'>abs</span>
    <span class='return return kw'>return</span> <span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span>
  <span class='end end kw'>end</span>
  
  <span class='def def kw'>def</span> <span class='ceil identifier id'>ceil</span>
    <span class='return return kw'>return</span> <span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='ceil identifier id'>ceil</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='unitless? fid id'>unitless?</span>
    <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='ceil identifier id'>ceil</span><span class='comma token'>,</span> <span class='@numerator ivar id'>@numerator</span><span class='comma token'>,</span> <span class='@denominator ivar id'>@denominator</span><span class='rparen token'>)</span>    
  <span class='end end kw'>end</span>
  
  <span class='def def kw'>def</span> <span class='floor identifier id'>floor</span>
    <span class='return return kw'>return</span> <span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='floor identifier id'>floor</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='unitless? fid id'>unitless?</span>
    <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='floor identifier id'>floor</span><span class='comma token'>,</span> <span class='@numerator ivar id'>@numerator</span><span class='comma token'>,</span> <span class='@denominator ivar id'>@denominator</span><span class='rparen token'>)</span>    
  <span class='end end kw'>end</span>

  <span class='comment val'># if unitless, returns an int, otherwise raises an error</span>
  <span class='def def kw'>def</span> <span class='to_i identifier id'>to_i</span>
    <span class='return return kw'>return</span> <span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='to_int identifier id'>to_int</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='unitless? fid id'>unitless?</span>
    <span class='raise identifier id'>raise</span> <span class='RuntimeError constant id'>RuntimeError</span><span class='comma token'>,</span> <span class='string val'>'Cannot convert to Integer unless unitless'</span>
  <span class='end end kw'>end</span>
  <span class='alias alias kw'>alias</span> <span class='symbol val'>:to_int</span> <span class='symbol val'>:to_i</span>
  
  <span class='comment val'># Tries to make a Time object from current unit.  Assumes the current unit hold the duration in seconds from the epoch.</span>
  <span class='def def kw'>def</span> <span class='to_time identifier id'>to_time</span>
    <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='at identifier id'>at</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='alias alias kw'>alias</span> <span class='symbol val'>:time</span> <span class='symbol val'>:to_time</span>

  <span class='def def kw'>def</span> <span class='truncate identifier id'>truncate</span>
    <span class='return return kw'>return</span> <span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='truncate identifier id'>truncate</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='unitless? fid id'>unitless?</span>
    <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='truncate identifier id'>truncate</span><span class='comma token'>,</span> <span class='@numerator ivar id'>@numerator</span><span class='comma token'>,</span> <span class='@denominator ivar id'>@denominator</span><span class='rparen token'>)</span>    
  <span class='end end kw'>end</span>

  <span class='comment val'># convert a duration to a DateTime.  This will work so long as the duration is the duration from the zero date</span>
  <span class='comment val'># defined by DateTime</span>
  <span class='def def kw'>def</span> <span class='to_datetime identifier id'>to_datetime</span>
    <span class='DateTime constant id'>DateTime</span><span class='dot token'>.</span><span class='new! fid id'>new!</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='string val'>'d'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='def def kw'>def</span> <span class='to_date identifier id'>to_date</span>
    <span class='Date constant id'>Date</span><span class='dot token'>.</span><span class='new0 identifier id'>new0</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='string val'>'d'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='def def kw'>def</span> <span class='round identifier id'>round</span>
    <span class='return return kw'>return</span> <span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='round identifier id'>round</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='unitless? fid id'>unitless?</span>
    <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='round identifier id'>round</span><span class='comma token'>,</span> <span class='@numerator ivar id'>@numerator</span><span class='comma token'>,</span> <span class='@denominator ivar id'>@denominator</span><span class='rparen token'>)</span>    
  <span class='end end kw'>end</span>
   
  <span class='comment val'># true if scalar is zero</span>
  <span class='def def kw'>def</span> <span class='zero? fid id'>zero?</span>
    <span class='return return kw'>return</span> <span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># '5 min'.unit.ago </span>
  <span class='def def kw'>def</span> <span class='ago identifier id'>ago</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='before identifier id'>before</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># '5 min'.before(time)</span>
  <span class='def def kw'>def</span> <span class='before identifier id'>before</span><span class='lparen token'>(</span><span class='time_point identifier id'>time_point</span> <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Must specify a Time&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='time_point identifier id'>time_point</span>
    <span class='if if kw'>if</span> <span class='String constant id'>String</span> <span class='eqq op'>===</span> <span class='time_point identifier id'>time_point</span>
      <span class='time_point identifier id'>time_point</span><span class='dot token'>.</span><span class='time identifier id'>time</span> <span class='minus op'>-</span> <span class='self self kw'>self</span> <span class='rescue rescue kw'>rescue</span> <span class='time_point identifier id'>time_point</span><span class='dot token'>.</span><span class='datetime identifier id'>datetime</span> <span class='minus op'>-</span> <span class='self self kw'>self</span>
    <span class='else else kw'>else</span>
      <span class='time_point identifier id'>time_point</span> <span class='minus op'>-</span> <span class='self self kw'>self</span> <span class='rescue rescue kw'>rescue</span> <span class='time_point identifier id'>time_point</span><span class='dot token'>.</span><span class='to_datetime identifier id'>to_datetime</span> <span class='minus op'>-</span> <span class='self self kw'>self</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='alias alias kw'>alias</span> <span class='symbol val'>:before_now</span> <span class='symbol val'>:before</span>
  
  <span class='comment val'># 'min'.since(time)</span>
  <span class='def def kw'>def</span> <span class='since identifier id'>since</span><span class='lparen token'>(</span><span class='time_point identifier id'>time_point</span> <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='rparen token'>)</span>
    <span class='case case kw'>case</span> <span class='time_point identifier id'>time_point</span>
    <span class='when when kw'>when</span> <span class='Time constant id'>Time</span><span class='colon op'>:</span>      <span class='lparen token'>(</span><span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span> <span class='minus op'>-</span> <span class='time_point identifier id'>time_point</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span><span class='lparen token'>(</span><span class='string val'>'s'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span>
    <span class='when when kw'>when</span> <span class='DateTime constant id'>DateTime</span><span class='comma token'>,</span> <span class='Date constant id'>Date</span><span class='colon op'>:</span>  <span class='lparen token'>(</span><span class='DateTime constant id'>DateTime</span><span class='dot token'>.</span><span class='now identifier id'>now</span> <span class='minus op'>-</span> <span class='time_point identifier id'>time_point</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span><span class='lparen token'>(</span><span class='string val'>'d'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span>
    <span class='when when kw'>when</span> <span class='String constant id'>String</span><span class='colon op'>:</span>    
      <span class='lparen token'>(</span><span class='DateTime constant id'>DateTime</span><span class='dot token'>.</span><span class='now identifier id'>now</span> <span class='minus op'>-</span> <span class='time_point identifier id'>time_point</span><span class='dot token'>.</span><span class='time identifier id'>time</span><span class='lparen token'>(</span><span class='symbol val'>:context=</span><span class='gt op'>&gt;</span><span class='symbol val'>:past</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span><span class='lparen token'>(</span><span class='string val'>'d'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Must specify a Time, DateTime, or String&quot;</span> 
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># 'min'.until(time)</span>
  <span class='def def kw'>def</span> <span class='until until kw'>until</span><span class='lparen token'>(</span><span class='time_point identifier id'>time_point</span> <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='rparen token'>)</span>
    <span class='case case kw'>case</span> <span class='time_point identifier id'>time_point</span>
    <span class='when when kw'>when</span> <span class='Time constant id'>Time</span><span class='colon op'>:</span>      <span class='lparen token'>(</span><span class='time_point identifier id'>time_point</span> <span class='minus op'>-</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span><span class='lparen token'>(</span><span class='string val'>'s'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span>
    <span class='when when kw'>when</span> <span class='DateTime constant id'>DateTime</span><span class='comma token'>,</span> <span class='Date constant id'>Date</span><span class='colon op'>:</span>  <span class='lparen token'>(</span><span class='time_point identifier id'>time_point</span> <span class='minus op'>-</span> <span class='DateTime constant id'>DateTime</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span><span class='lparen token'>(</span><span class='string val'>'d'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span>
    <span class='when when kw'>when</span> <span class='String constant id'>String</span><span class='colon op'>:</span>
      <span class='r identifier id'>r</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='time_point identifier id'>time_point</span><span class='dot token'>.</span><span class='time identifier id'>time</span><span class='lparen token'>(</span><span class='symbol val'>:context=</span><span class='gt op'>&gt;</span><span class='symbol val'>:future</span><span class='rparen token'>)</span> <span class='minus op'>-</span> <span class='DateTime constant id'>DateTime</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='rparen token'>)</span>
      <span class='Time constant id'>Time</span> <span class='eqq op'>===</span> <span class='time_point identifier id'>time_point</span><span class='dot token'>.</span><span class='time identifier id'>time</span> <span class='integer val'>? </span><span class='r identifier id'>r</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span><span class='lparen token'>(</span><span class='string val'>'s'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='r identifier id'>r</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span><span class='lparen token'>(</span><span class='string val'>'d'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to identifier id'>to</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Must specify a Time, DateTime, or String&quot;</span> 
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># '5 min'.from(time)</span>
  <span class='def def kw'>def</span> <span class='from identifier id'>from</span><span class='lparen token'>(</span><span class='time_point identifier id'>time_point</span> <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Must specify a Time&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='time_point identifier id'>time_point</span>
    <span class='if if kw'>if</span> <span class='String constant id'>String</span> <span class='eqq op'>===</span> <span class='time_point identifier id'>time_point</span>
      <span class='time_point identifier id'>time_point</span><span class='dot token'>.</span><span class='time identifier id'>time</span> <span class='plus op'>+</span> <span class='self self kw'>self</span> <span class='rescue rescue kw'>rescue</span> <span class='time_point identifier id'>time_point</span><span class='dot token'>.</span><span class='datetime identifier id'>datetime</span> <span class='plus op'>+</span> <span class='self self kw'>self</span>
    <span class='else else kw'>else</span>
      <span class='time_point identifier id'>time_point</span> <span class='plus op'>+</span> <span class='self self kw'>self</span> <span class='rescue rescue kw'>rescue</span> <span class='time_point identifier id'>time_point</span><span class='dot token'>.</span><span class='to_datetime identifier id'>to_datetime</span> <span class='plus op'>+</span> <span class='self self kw'>self</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='alias alias kw'>alias</span> <span class='symbol val'>:after</span> <span class='symbol val'>:from</span>
  <span class='alias alias kw'>alias</span> <span class='symbol val'>:from_now</span> <span class='symbol val'>:from</span>
  
  <span class='comment val'># returns next unit in a range.  '1 mm'.unit.succ #=&gt; '2 mm'.unit</span>
  <span class='comment val'># only works when the scalar is an integer    </span>
  <span class='def def kw'>def</span> <span class='succ identifier id'>succ</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Non Integer Scalar&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='@scalar ivar id'>@scalar</span> <span class='eq op'>==</span> <span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
    <span class='q identifier id'>q</span> <span class='assign token'>=</span> <span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='dot token'>.</span><span class='succ identifier id'>succ</span>
    <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='q identifier id'>q</span><span class='comma token'>,</span> <span class='@numerator ivar id'>@numerator</span><span class='comma token'>,</span> <span class='@denominator ivar id'>@denominator</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># automatically coerce objects to units when possible</span>
  <span class='comment val'># if an object defines a 'to_unit' method, it will be coerced using that method</span>
  <span class='def def kw'>def</span> <span class='coerce identifier id'>coerce</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span> <span class='colon op'>:</span><span class='to_unit identifier id'>to_unit</span>
      <span class='return return kw'>return</span> <span class='lbrack token'>[</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='to_unit identifier id'>to_unit</span><span class='comma token'>,</span> <span class='self self kw'>self</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>
    <span class='case case kw'>case</span> <span class='other identifier id'>other</span>
    <span class='when when kw'>when</span> <span class='Unit constant id'>Unit</span> <span class='colon op'>:</span> <span class='lbrack token'>[</span><span class='other identifier id'>other</span><span class='comma token'>,</span> <span class='self self kw'>self</span><span class='rbrack token'>]</span>
    <span class='else else kw'>else</span> 
      <span class='lbrack token'>[</span><span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='self self kw'>self</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
      
  <span class='comment val'># Protected and Private Functions that should only be called from this class</span>
  <span class='protected identifier id'>protected</span>
  
  
  <span class='def def kw'>def</span> <span class='update_base_scalar identifier id'>update_base_scalar</span>
    <span class='return return kw'>return</span> <span class='@base_scalar ivar id'>@base_scalar</span> <span class='unless unless_mod kw'>unless</span> <span class='@base_scalar ivar id'>@base_scalar</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='if if kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='is_base? fid id'>is_base?</span>
      <span class='@base_scalar ivar id'>@base_scalar</span> <span class='assign token'>=</span> <span class='@scalar ivar id'>@scalar</span>
      <span class='@signature ivar id'>@signature</span> <span class='assign token'>=</span> <span class='unit_signature identifier id'>unit_signature</span>
    <span class='else else kw'>else</span>
      <span class='base identifier id'>base</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='to_base identifier id'>to_base</span>
      <span class='@base_scalar ivar id'>@base_scalar</span> <span class='assign token'>=</span> <span class='base identifier id'>base</span><span class='dot token'>.</span><span class='scalar identifier id'>scalar</span>
      <span class='@signature ivar id'>@signature</span> <span class='assign token'>=</span> <span class='base identifier id'>base</span><span class='dot token'>.</span><span class='signature identifier id'>signature</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># calculates the unit signature vector used by unit_signature</span>
  <span class='def def kw'>def</span> <span class='unit_signature_vector identifier id'>unit_signature_vector</span>
      <span class='return return kw'>return</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='to_base identifier id'>to_base</span><span class='dot token'>.</span><span class='unit_signature_vector identifier id'>unit_signature_vector</span> <span class='unless unless_mod kw'>unless</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='is_base? fid id'>is_base?</span>
      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='self self kw'>self</span>
      <span class='vector identifier id'>vector</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='SIGNATURE_VECTOR constant id'>SIGNATURE_VECTOR</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='comma token'>,</span><span class='integer val'>0</span><span class='rparen token'>)</span>
      <span class='for for kw'>for</span> <span class='element identifier id'>element</span> <span class='in in kw'>in</span> <span class='@numerator ivar id'>@numerator</span>
        <span class='if if kw'>if</span> <span class='r identifier id'>r</span><span class='assign token'>=</span><span class='@@ALL_UNIT_DEFINITIONS ivar id'>@@ALL_UNIT_DEFINITIONS</span><span class='lbrack token'>[</span><span class='element identifier id'>element</span><span class='rbrack token'>]</span>
            <span class='n identifier id'>n</span> <span class='assign token'>=</span> <span class='SIGNATURE_VECTOR constant id'>SIGNATURE_VECTOR</span><span class='dot token'>.</span><span class='index identifier id'>index</span><span class='lparen token'>(</span><span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
           <span class='vector identifier id'>vector</span><span class='lbrack token'>[</span><span class='n identifier id'>n</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='vector identifier id'>vector</span><span class='lbrack token'>[</span><span class='n identifier id'>n</span><span class='rbrack token'>]</span> <span class='plus op'>+</span> <span class='integer val'>1</span> <span class='if if_mod kw'>if</span> <span class='n identifier id'>n</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
      <span class='for for kw'>for</span> <span class='element identifier id'>element</span> <span class='in in kw'>in</span> <span class='@denominator ivar id'>@denominator</span>
        <span class='if if kw'>if</span> <span class='r identifier id'>r</span><span class='assign token'>=</span><span class='@@ALL_UNIT_DEFINITIONS ivar id'>@@ALL_UNIT_DEFINITIONS</span><span class='lbrack token'>[</span><span class='element identifier id'>element</span><span class='rbrack token'>]</span>
          <span class='n identifier id'>n</span> <span class='assign token'>=</span> <span class='SIGNATURE_VECTOR constant id'>SIGNATURE_VECTOR</span><span class='dot token'>.</span><span class='index identifier id'>index</span><span class='lparen token'>(</span><span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
          <span class='vector identifier id'>vector</span><span class='lbrack token'>[</span><span class='n identifier id'>n</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='vector identifier id'>vector</span><span class='lbrack token'>[</span><span class='n identifier id'>n</span><span class='rbrack token'>]</span> <span class='minus op'>-</span> <span class='integer val'>1</span> <span class='if if_mod kw'>if</span> <span class='n identifier id'>n</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
      <span class='vector identifier id'>vector</span>
  <span class='end end kw'>end</span>
    
  <span class='private identifier id'>private</span>
  
  <span class='def def kw'>def</span> <span class='initialize_copy identifier id'>initialize_copy</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
    <span class='@numerator ivar id'>@numerator</span> <span class='assign token'>=</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='numerator identifier id'>numerator</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
    <span class='@denominator ivar id'>@denominator</span> <span class='assign token'>=</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='denominator identifier id'>denominator</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>    
  <span class='end end kw'>end</span>
  
  <span class='comment val'># calculates the unit signature id for use in comparing compatible units and simplification</span>
  <span class='comment val'># the signature is based on a simple classification of units and is based on the following publication</span>
  <span class='comment val'>#  </span>
  <span class='comment val'>#  Novak, G.S., Jr. &quot;Conversion of units of measurement&quot;, IEEE Transactions on Software Engineering,</span>
  <span class='comment val'>#  21(8), Aug 1995, pp.651-661</span>
  <span class='comment val'>#  doi://10.1109/32.403789</span>
  <span class='comment val'>#  http://ieeexplore.ieee.org/Xplore/login.jsp?url=/iel1/32/9079/00403789.pdf?isnumber=9079&amp;prod=JNL&amp;arnumber=403789&amp;arSt=651&amp;ared=661&amp;arAuthor=Novak%2C+G.S.%2C+Jr.</span>
  <span class='comment val'>#</span>
  <span class='def def kw'>def</span> <span class='unit_signature identifier id'>unit_signature</span>
    <span class='return return kw'>return</span> <span class='@signature ivar id'>@signature</span> <span class='unless unless_mod kw'>unless</span> <span class='@signature ivar id'>@signature</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='vector identifier id'>vector</span> <span class='assign token'>=</span> <span class='unit_signature_vector identifier id'>unit_signature_vector</span>
    <span class='vector identifier id'>vector</span><span class='dot token'>.</span><span class='each_with_index identifier id'>each_with_index</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='item identifier id'>item</span><span class='comma token'>,</span><span class='index identifier id'>index</span><span class='bitor op'>|</span> <span class='vector identifier id'>vector</span><span class='lbrack token'>[</span><span class='index identifier id'>index</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='item identifier id'>item</span> <span class='mult op'>*</span> <span class='integer val'>20</span><span class='pow op'>**</span><span class='index identifier id'>index</span><span class='rbrace token'>}</span>
    <span class='@signature ivar id'>@signature</span><span class='assign token'>=</span><span class='vector identifier id'>vector</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='sum identifier id'>sum</span><span class='comma token'>,</span><span class='n identifier id'>n</span><span class='bitor op'>|</span> <span class='sum identifier id'>sum</span><span class='plus op'>+</span><span class='n identifier id'>n</span><span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
  
  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='eliminate_terms identifier id'>eliminate_terms</span><span class='lparen token'>(</span><span class='q identifier id'>q</span><span class='comma token'>,</span> <span class='n identifier id'>n</span><span class='comma token'>,</span> <span class='d identifier id'>d</span><span class='rparen token'>)</span>
    <span class='num identifier id'>num</span> <span class='assign token'>=</span> <span class='n identifier id'>n</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
    <span class='den identifier id'>den</span> <span class='assign token'>=</span> <span class='d identifier id'>d</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
    
    <span class='num identifier id'>num</span><span class='dot token'>.</span><span class='delete_if identifier id'>delete_if</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='v identifier id'>v</span><span class='bitor op'>|</span> <span class='v identifier id'>v</span> <span class='eq op'>==</span> <span class='UNITY constant id'>UNITY</span><span class='rbrace token'>}</span>
    <span class='den identifier id'>den</span><span class='dot token'>.</span><span class='delete_if identifier id'>delete_if</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='v identifier id'>v</span><span class='bitor op'>|</span> <span class='v identifier id'>v</span> <span class='eq op'>==</span> <span class='UNITY constant id'>UNITY</span><span class='rbrace token'>}</span>
    <span class='combined identifier id'>combined</span> <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span>
 
    <span class='i identifier id'>i</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
    <span class='loop identifier id'>loop</span> <span class='do do kw'>do</span> 
      <span class='break break kw'>break</span> <span class='if if_mod kw'>if</span> <span class='i identifier id'>i</span> <span class='gt op'>&gt;</span> <span class='num identifier id'>num</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
      <span class='if if kw'>if</span> <span class='@@PREFIX_VALUES ivar id'>@@PREFIX_VALUES</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span> <span class='num identifier id'>num</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span>
        <span class='k identifier id'>k</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='num identifier id'>num</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='num identifier id'>num</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
        <span class='i identifier id'>i</span> <span class='opasgn op'>+=</span> <span class='integer val'>2</span>
      <span class='else else kw'>else</span>
        <span class='k identifier id'>k</span> <span class='assign token'>=</span> <span class='num identifier id'>num</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span>
        <span class='i identifier id'>i</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
      <span class='end end kw'>end</span>
      <span class='combined identifier id'>combined</span><span class='lbrack token'>[</span><span class='k identifier id'>k</span><span class='rbrack token'>]</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span> <span class='unless unless_mod kw'>unless</span> <span class='k identifier id'>k</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='orop op'>||</span> <span class='k identifier id'>k</span> <span class='eq op'>==</span> <span class='UNITY constant id'>UNITY</span>
    <span class='end end kw'>end</span>
    
    <span class='j identifier id'>j</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
    <span class='loop identifier id'>loop</span> <span class='do do kw'>do</span>
      <span class='break break kw'>break</span> <span class='if if_mod kw'>if</span> <span class='j identifier id'>j</span> <span class='gt op'>&gt;</span> <span class='den identifier id'>den</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
        <span class='if if kw'>if</span> <span class='@@PREFIX_VALUES ivar id'>@@PREFIX_VALUES</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span> <span class='den identifier id'>den</span><span class='lbrack token'>[</span><span class='j identifier id'>j</span><span class='rbrack token'>]</span>
          <span class='k identifier id'>k</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='den identifier id'>den</span><span class='lbrack token'>[</span><span class='j identifier id'>j</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='den identifier id'>den</span><span class='lbrack token'>[</span><span class='j identifier id'>j</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
          <span class='j identifier id'>j</span> <span class='opasgn op'>+=</span> <span class='integer val'>2</span>
        <span class='else else kw'>else</span>
          <span class='k identifier id'>k</span> <span class='assign token'>=</span> <span class='den identifier id'>den</span><span class='lbrack token'>[</span><span class='j identifier id'>j</span><span class='rbrack token'>]</span>
          <span class='j identifier id'>j</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
        <span class='end end kw'>end</span>
      <span class='combined identifier id'>combined</span><span class='lbrack token'>[</span><span class='k identifier id'>k</span><span class='rbrack token'>]</span> <span class='opasgn op'>-=</span> <span class='integer val'>1</span> <span class='unless unless_mod kw'>unless</span> <span class='k identifier id'>k</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='orop op'>||</span> <span class='k identifier id'>k</span> <span class='eq op'>==</span> <span class='UNITY constant id'>UNITY</span>
    <span class='end end kw'>end</span>
 
    <span class='num identifier id'>num</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='den identifier id'>den</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='for for kw'>for</span> <span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='value identifier id'>value</span> <span class='in in kw'>in</span> <span class='combined identifier id'>combined</span> <span class='do do kw'>do</span> 
      <span class='case case kw'>case</span> 
      <span class='when when kw'>when</span> <span class='value identifier id'>value</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span> <span class='colon op'>:</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='times identifier id'>times</span> <span class='lbrace token'>{</span><span class='num identifier id'>num</span> <span class='lshft op'>&lt;&lt;</span> <span class='key identifier id'>key</span><span class='rbrace token'>}</span>
      <span class='when when kw'>when</span> <span class='value identifier id'>value</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span> <span class='colon op'>:</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span><span class='dot token'>.</span><span class='times identifier id'>times</span> <span class='lbrace token'>{</span><span class='den identifier id'>den</span> <span class='lshft op'>&lt;&lt;</span> <span class='key identifier id'>key</span><span class='rbrace token'>}</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='num identifier id'>num</span> <span class='assign token'>=</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span> <span class='if if_mod kw'>if</span> <span class='num identifier id'>num</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='den identifier id'>den</span> <span class='assign token'>=</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span> <span class='if if_mod kw'>if</span> <span class='den identifier id'>den</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='lbrace token'>{</span><span class='symbol val'>:scalar=</span><span class='gt op'>&gt;</span><span class='q identifier id'>q</span><span class='comma token'>,</span> <span class='symbol val'>:numerator=</span><span class='gt op'>&gt;</span><span class='num identifier id'>num</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span><span class='comma token'>,</span> <span class='symbol val'>:denominator=</span><span class='gt op'>&gt;</span><span class='den identifier id'>den</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span><span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
      
  
  <span class='comment val'># parse a string into a unit object.</span>
  <span class='comment val'># Typical formats like : </span>
  <span class='comment val'>#  &quot;5.6 kg*m/s^2&quot;</span>
  <span class='comment val'>#  &quot;5.6 kg*m*s^-2&quot;</span>
  <span class='comment val'>#  &quot;5.6 kilogram*meter*second^-2&quot;</span>
  <span class='comment val'>#  &quot;2.2 kPa&quot;</span>
  <span class='comment val'>#  &quot;37 degC&quot;</span>
  <span class='comment val'>#  &quot;1&quot;  -- creates a unitless constant with value 1</span>
  <span class='comment val'>#  &quot;GPa&quot;  -- creates a unit with scalar 1 with units 'GPa'</span>
  <span class='comment val'>#  6'4&quot;  -- recognized as 6 feet + 4 inches</span>
  <span class='comment val'>#  8 lbs 8 oz -- recognized as 8 lbs + 8 ounces </span>
  <span class='def def kw'>def</span> <span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='passed_unit_string identifier id'>passed_unit_string</span><span class='assign token'>=</span><span class='string val'>&quot;0&quot;</span><span class='rparen token'>)</span>
    <span class='unit_string identifier id'>unit_string</span> <span class='assign token'>=</span> <span class='passed_unit_string identifier id'>passed_unit_string</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
    <span class='if if kw'>if</span> <span class='unit_string identifier id'>unit_string</span> <span class='match op'>=~</span> <span class='dregexp node'>/\$\s*(#{NUMBER_REGEX})/</span>
      <span class='unit_string identifier id'>unit_string</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{$1} USD&quot;</span>
    <span class='end end kw'>end</span>
    <span class='unit_string identifier id'>unit_string</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='regexp val'>/%/</span><span class='comma token'>,</span><span class='string val'>'percent'</span><span class='rparen token'>)</span>
    <span class='unit_string identifier id'>unit_string</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='regexp val'>/'/</span><span class='comma token'>,</span><span class='string val'>'feet'</span><span class='rparen token'>)</span>
    <span class='unit_string identifier id'>unit_string</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='regexp val'>/&quot;/</span><span class='comma token'>,</span><span class='string val'>'inch'</span><span class='rparen token'>)</span>
    <span class='unit_string identifier id'>unit_string</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='regexp val'>/#/</span><span class='comma token'>,</span><span class='string val'>'pound'</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='defined? defined kw'>defined?</span><span class='lparen token'>(</span><span class='Uncertain constant id'>Uncertain</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='unit_string identifier id'>unit_string</span> <span class='match op'>=~</span> <span class='regexp val'>/(\+\/-|&amp;plusmn;)/</span>
      <span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='uncertainty identifier id'>uncertainty</span><span class='comma token'>,</span> <span class='unit_s identifier id'>unit_s</span> <span class='assign token'>=</span> <span class='unit_string identifier id'>unit_string</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='UNCERTAIN_REGEX constant id'>UNCERTAIN_REGEX</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='unit_s identifier id'>unit_s</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span> <span class='mult op'>*</span> <span class='Uncertain constant id'>Uncertain</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='comma token'>,</span><span class='uncertainty identifier id'>uncertainty</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='rparen token'>)</span>
      <span class='copy identifier id'>copy</span><span class='lparen token'>(</span><span class='result identifier id'>result</span><span class='rparen token'>)</span>
      <span class='return return kw'>return</span>  
    <span class='end end kw'>end</span>
    
    <span class='if if kw'>if</span> <span class='defined? defined kw'>defined?</span><span class='lparen token'>(</span><span class='Complex constant id'>Complex</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='unit_string identifier id'>unit_string</span> <span class='match op'>=~</span> <span class='COMPLEX_NUMBER constant id'>COMPLEX_NUMBER</span>
      <span class='real identifier id'>real</span><span class='comma token'>,</span> <span class='imaginary identifier id'>imaginary</span><span class='comma token'>,</span> <span class='unit_s identifier id'>unit_s</span> <span class='assign token'>=</span> <span class='unit_string identifier id'>unit_string</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='COMPLEX_REGEX constant id'>COMPLEX_REGEX</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='Unit constant id'>Unit</span><span class='lparen token'>(</span><span class='unit_s identifier id'>unit_s</span> <span class='orop op'>||</span> <span class='string val'>'1'</span><span class='rparen token'>)</span> <span class='mult op'>*</span> <span class='Complex constant id'>Complex</span><span class='lparen token'>(</span><span class='real identifier id'>real</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='comma token'>,</span><span class='imaginary identifier id'>imaginary</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='rparen token'>)</span>
      <span class='copy identifier id'>copy</span><span class='lparen token'>(</span><span class='result identifier id'>result</span><span class='rparen token'>)</span>
      <span class='return return kw'>return</span> 
    <span class='end end kw'>end</span>
    
    <span class='if if kw'>if</span> <span class='defined? defined kw'>defined?</span><span class='lparen token'>(</span><span class='Rational constant id'>Rational</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='unit_string identifier id'>unit_string</span> <span class='match op'>=~</span> <span class='RATIONAL_NUMBER constant id'>RATIONAL_NUMBER</span>
        <span class='numerator identifier id'>numerator</span><span class='comma token'>,</span> <span class='denominator identifier id'>denominator</span><span class='comma token'>,</span> <span class='unit_s identifier id'>unit_s</span> <span class='assign token'>=</span> <span class='unit_string identifier id'>unit_string</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='RATIONAL_REGEX constant id'>RATIONAL_REGEX</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
        <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='Unit constant id'>Unit</span><span class='lparen token'>(</span><span class='unit_s identifier id'>unit_s</span> <span class='orop op'>||</span> <span class='string val'>'1'</span><span class='rparen token'>)</span> <span class='mult op'>*</span> <span class='Rational constant id'>Rational</span><span class='lparen token'>(</span><span class='numerator identifier id'>numerator</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='comma token'>,</span><span class='denominator identifier id'>denominator</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rparen token'>)</span>
        <span class='copy identifier id'>copy</span><span class='lparen token'>(</span><span class='result identifier id'>result</span><span class='rparen token'>)</span>
        <span class='return return kw'>return</span> 
    <span class='end end kw'>end</span>
    
    <span class='unit_string identifier id'>unit_string</span> <span class='match op'>=~</span> <span class='NUMBER_REGEX constant id'>NUMBER_REGEX</span>
    <span class='unit identifier id'>unit</span> <span class='assign token'>=</span> <span class='@@cached_units ivar id'>@@cached_units</span><span class='lbrack token'>[</span><span class='$2 nth_ref id'>$2</span><span class='rbrack token'>]</span> 
    <span class='mult identifier id'>mult</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='$1 nth_ref id'>$1</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='integer val'>? </span><span class='float val'>1.0</span> <span class='colon op'>:</span> <span class='$1 nth_ref id'>$1</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='rparen token'>)</span> <span class='rescue rescue kw'>rescue</span> <span class='float val'>1.0</span>
    <span class='if if kw'>if</span> <span class='unit identifier id'>unit</span>
      <span class='copy identifier id'>copy</span><span class='lparen token'>(</span><span class='unit identifier id'>unit</span><span class='rparen token'>)</span>
      <span class='@scalar ivar id'>@scalar</span> <span class='opasgn op'>*=</span> <span class='mult identifier id'>mult</span>
      <span class='@base_scalar ivar id'>@base_scalar</span> <span class='opasgn op'>*=</span> <span class='mult identifier id'>mult</span>
      <span class='return return kw'>return</span> <span class='self self kw'>self</span>
    <span class='end end kw'>end</span>
    <span class='unit_string identifier id'>unit_string</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='dregexp node'>/&lt;(#{@@UNIT_REGEX})&gt;&lt;(#{@@UNIT_REGEX})&gt;/</span><span class='comma token'>,</span> <span class='string val'>'\1*\2'</span><span class='rparen token'>)</span>
    <span class='unit_string identifier id'>unit_string</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='regexp val'>/[&lt;&gt;]/</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span>
    
    <span class='if if kw'>if</span> <span class='unit_string identifier id'>unit_string</span> <span class='match op'>=~</span> <span class='regexp val'>/:/</span>
      <span class='hours identifier id'>hours</span><span class='comma token'>,</span> <span class='minutes identifier id'>minutes</span><span class='comma token'>,</span> <span class='seconds identifier id'>seconds</span><span class='comma token'>,</span> <span class='microseconds identifier id'>microseconds</span> <span class='assign token'>=</span> <span class='unit_string identifier id'>unit_string</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='TIME_REGEX constant id'>TIME_REGEX</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Invalid Duration&quot;</span> <span class='if if_mod kw'>if</span> <span class='lbrack token'>[</span><span class='hours identifier id'>hours</span><span class='comma token'>,</span> <span class='minutes identifier id'>minutes</span><span class='comma token'>,</span> <span class='seconds identifier id'>seconds</span><span class='comma token'>,</span> <span class='microseconds identifier id'>microseconds</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='all? fid id'>all?</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span><span class='rbrace token'>}</span>
      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{hours || 0} h&quot;</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span> <span class='plus op'>+</span> 
               <span class='dstring node'>&quot;#{minutes || 0} minutes&quot;</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span> <span class='plus op'>+</span> 
               <span class='dstring node'>&quot;#{seconds || 0} seconds&quot;</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span> <span class='plus op'>+</span>
               <span class='dstring node'>&quot;#{microseconds || 0} usec&quot;</span><span class='dot token'>.</span><span class='unit identifier id'>unit</span>
      <span class='copy identifier id'>copy</span><span class='lparen token'>(</span><span class='result identifier id'>result</span><span class='rparen token'>)</span>
      <span class='return return kw'>return</span>
    <span class='end end kw'>end</span>
    
    
    <span class='comment val'># Special processing for unusual unit strings</span>
    <span class='comment val'># feet -- 6'5&quot;</span>
    <span class='feet identifier id'>feet</span><span class='comma token'>,</span> <span class='inches identifier id'>inches</span> <span class='assign token'>=</span> <span class='unit_string identifier id'>unit_string</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='FEET_INCH_REGEX constant id'>FEET_INCH_REGEX</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
    <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='feet identifier id'>feet</span> <span class='andop op'>&amp;&amp;</span> <span class='inches identifier id'>inches</span><span class='rparen token'>)</span>
      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{feet} ft&quot;</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{inches} inches&quot;</span><span class='rparen token'>)</span>
      <span class='copy identifier id'>copy</span><span class='lparen token'>(</span><span class='result identifier id'>result</span><span class='rparen token'>)</span>
      <span class='return return kw'>return</span> 
    <span class='end end kw'>end</span>

    <span class='comment val'># weight -- 8 lbs 12 oz    </span>
    <span class='pounds identifier id'>pounds</span><span class='comma token'>,</span> <span class='oz identifier id'>oz</span> <span class='assign token'>=</span> <span class='unit_string identifier id'>unit_string</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='LBS_OZ_REGEX constant id'>LBS_OZ_REGEX</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
    <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='pounds identifier id'>pounds</span> <span class='andop op'>&amp;&amp;</span> <span class='oz identifier id'>oz</span><span class='rparen token'>)</span>
      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{pounds} lbs&quot;</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{oz} oz&quot;</span><span class='rparen token'>)</span>
      <span class='copy identifier id'>copy</span><span class='lparen token'>(</span><span class='result identifier id'>result</span><span class='rparen token'>)</span>
      <span class='return return kw'>return</span> 
    <span class='end end kw'>end</span>
    
    <span class='raise identifier id'>raise</span><span class='lparen token'>(</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;'#{passed_unit_string}' Unit not recognized&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='unit_string identifier id'>unit_string</span><span class='dot token'>.</span><span class='count identifier id'>count</span><span class='lparen token'>(</span><span class='string val'>'/'</span><span class='rparen token'>)</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
    <span class='raise identifier id'>raise</span><span class='lparen token'>(</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;'#{passed_unit_string}' Unit not recognized&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='unit_string identifier id'>unit_string</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='regexp val'>/\s[02-9]/</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='@scalar ivar id'>@scalar</span><span class='comma token'>,</span> <span class='top identifier id'>top</span><span class='comma token'>,</span> <span class='bottom identifier id'>bottom</span> <span class='assign token'>=</span> <span class='unit_string identifier id'>unit_string</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='UNIT_STRING_REGEX constant id'>UNIT_STRING_REGEX</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>  <span class='comment val'>#parse the string into parts</span>
    <span class='top identifier id'>top</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='TOP_REGEX constant id'>TOP_REGEX</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='item identifier id'>item</span><span class='bitor op'>|</span>
      <span class='n identifier id'>n</span> <span class='assign token'>=</span> <span class='item identifier id'>item</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
      <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{item[0]} &quot;</span>
      <span class='case case kw'>case</span> 
        <span class='when when kw'>when</span> <span class='n identifier id'>n</span><span class='geq op'>&gt;=</span><span class='integer val'>0</span> <span class='colon op'>:</span> <span class='top identifier id'>top</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='dregexp node'>/#{item[0]}(\^|\*\*)#{n}/</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='s identifier id'>s</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span> <span class='mult op'>*</span> <span class='n identifier id'>n</span><span class='rbrace token'>}</span>
        <span class='when when kw'>when</span> <span class='n identifier id'>n</span><span class='lt op'>&lt;</span><span class='integer val'>0</span> <span class='colon op'>:</span> <span class='bottom identifier id'>bottom</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{bottom} #{x * -n}&quot;</span><span class='semicolon token'>;</span> <span class='top identifier id'>top</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='dregexp node'>/#{item[0]}(\^|\*\*)#{n}/</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span> 
    <span class='bottom identifier id'>bottom</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='BOTTOM_REGEX constant id'>BOTTOM_REGEX</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='s identifier id'>s</span><span class='bitor op'>|</span> <span class='dstring node'>&quot;#{$1} &quot;</span> <span class='mult op'>*</span> <span class='$2 nth_ref id'>$2</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='bottom identifier id'>bottom</span>
    <span class='@scalar ivar id'>@scalar</span> <span class='assign token'>=</span> <span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span> <span class='unless unless_mod kw'>unless</span> <span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='orop op'>||</span> <span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='@scalar ivar id'>@scalar</span> <span class='assign token'>=</span> <span class='integer val'>1</span> <span class='unless unless_mod kw'>unless</span> <span class='@scalar ivar id'>@scalar</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span> <span class='Numeric constant id'>Numeric</span> 
        
    <span class='@numerator ivar id'>@numerator</span> <span class='opasgn op'>||=</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span>
    <span class='@denominator ivar id'>@denominator</span> <span class='opasgn op'>||=</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span>
    <span class='@numerator ivar id'>@numerator</span> <span class='assign token'>=</span> <span class='top identifier id'>top</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='@@UNIT_MATCH_REGEX ivar id'>@@UNIT_MATCH_REGEX</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='delete_if identifier id'>delete_if</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span> <span class='if if_mod kw'>if</span> <span class='top identifier id'>top</span>
    <span class='@denominator ivar id'>@denominator</span> <span class='assign token'>=</span> <span class='bottom identifier id'>bottom</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='@@UNIT_MATCH_REGEX ivar id'>@@UNIT_MATCH_REGEX</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='delete_if identifier id'>delete_if</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span> <span class='if if_mod kw'>if</span> <span class='bottom identifier id'>bottom</span>
    
    
    <span class='us identifier id'>us</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{(top || '' + bottom || '')}&quot;</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='@@UNIT_MATCH_REGEX ivar id'>@@UNIT_MATCH_REGEX</span><span class='comma token'>,</span><span class='string val'>''</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/[\d\*, &quot;'_^\/\$]/</span><span class='comma token'>,</span><span class='string val'>''</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span><span class='lparen token'>(</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;'#{passed_unit_string}' Unit not recognized #{us.inspect}&quot;</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='us identifier id'>us</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>

    <span class='@numerator ivar id'>@numerator</span> <span class='assign token'>=</span> <span class='@numerator ivar id'>@numerator</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='item identifier id'>item</span><span class='bitor op'>|</span>
       <span class='@@PREFIX_MAP ivar id'>@@PREFIX_MAP</span><span class='lbrack token'>[</span><span class='item identifier id'>item</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='lbrack token'>[</span><span class='@@PREFIX_MAP ivar id'>@@PREFIX_MAP</span><span class='lbrack token'>[</span><span class='item identifier id'>item</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='@@UNIT_MAP ivar id'>@@UNIT_MAP</span><span class='lbrack token'>[</span><span class='item identifier id'>item</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='lbrack token'>[</span><span class='@@UNIT_MAP ivar id'>@@UNIT_MAP</span><span class='lbrack token'>[</span><span class='item identifier id'>item</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span><span class='dot token'>.</span><span class='delete_if identifier id'>delete_if</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span><span class='rbrace token'>}</span>

    <span class='@denominator ivar id'>@denominator</span> <span class='assign token'>=</span> <span class='@denominator ivar id'>@denominator</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='item identifier id'>item</span><span class='bitor op'>|</span>
       <span class='@@PREFIX_MAP ivar id'>@@PREFIX_MAP</span><span class='lbrack token'>[</span><span class='item identifier id'>item</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='lbrack token'>[</span><span class='@@PREFIX_MAP ivar id'>@@PREFIX_MAP</span><span class='lbrack token'>[</span><span class='item identifier id'>item</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='@@UNIT_MAP ivar id'>@@UNIT_MAP</span><span class='lbrack token'>[</span><span class='item identifier id'>item</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='lbrack token'>[</span><span class='@@UNIT_MAP ivar id'>@@UNIT_MAP</span><span class='lbrack token'>[</span><span class='item identifier id'>item</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span><span class='dot token'>.</span><span class='delete_if identifier id'>delete_if</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span><span class='rbrace token'>}</span>

    <span class='@numerator ivar id'>@numerator</span> <span class='assign token'>=</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span> <span class='if if_mod kw'>if</span> <span class='@numerator ivar id'>@numerator</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> 
    <span class='@denominator ivar id'>@denominator</span> <span class='assign token'>=</span> <span class='UNITY_ARRAY constant id'>UNITY_ARRAY</span> <span class='if if_mod kw'>if</span> <span class='@denominator ivar id'>@denominator</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='self self kw'>self</span>
  <span class='end end kw'>end</span> 
<span class='end end kw'>end</span>

<span class='Unit constant id'>Unit</span><span class='dot token'>.</span><span class='setup identifier id'>setup</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Wed Mar 17 02:01:11 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>
  0.5.3 (ruby-1.8.7).
</div>

  </body>
</html>